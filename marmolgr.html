<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hackers Cluedo - Marimoligram</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Ionicons -->
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Pacifico&display=swap" rel="stylesheet">
    <style>
        :root { 
            --clr-pink: #F976DD;
            --clr-blue: #3b82f6;
            --clr: var(--clr-pink); /* Color por defecto */
            --bg-main: #f3f4f6;
        }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-main); }
        .brand-font { font-family: 'Pacifico', cursive; color: var(--clr); }
        
        /* --- ESTILOS DE NAVEGACI√ìN CORREGIDOS --- */
        .navigation { 
            width: 100%;
            height: 70px; 
            background: var(--clr);
            position: relative; 
            display: flex; 
            justify-content: center; 
            align-items: center;
        }
        .navigation ul { display: flex; width: 350px; }
        .navigation ul li { position: relative; list-style: none; width: 70px; height: 70px; z-index: 1; }
        .navigation ul li a { position: relative; display: flex; justify-content: center; align-items: center; flex-direction: column; width: 100%; height: 100%; text-align: center; font-weight: 500; cursor: pointer; }
        
        .navigation ul li a .icon { 
            position: relative; 
            display: block; 
            line-height: 75px; 
            font-size: 1.8rem; 
            text-align: center; 
            transition: 0.5s; 
            color: #ffffff;
        }
        .navigation ul li.active a .icon { 
            transform: translateY(-32px); 
            color: var(--clr);
        }
        
        .indicator { 
            position: absolute; 
            top: -50%; 
            width: 70px; 
            height: 70px; 
            background: var(--bg-main);
            border-radius: 50%; 
            transition: 0.5s; 
        }

        .navigation ul li:nth-child(1).active ~ .indicator { transform: translateX(calc(70px * 0)); }
        .navigation ul li:nth-child(2).active ~ .indicator { transform: translateX(calc(70px * 1)); }
        .navigation ul li:nth-child(3).active ~ .indicator { transform: translateX(calc(70px * 2)); }
        .navigation ul li:nth-child(4).active ~ .indicator { transform: translateX(calc(70px * 3)); }
        .navigation ul li:nth-child(5).active ~ .indicator { transform: translateX(calc(70px * 4)); }
        /* --- FIN DE ESTILOS CORREGIDOS --- */

        .notification-dot { 
            position: absolute; 
            top: 15px; 
            right: 18px;
            transition: 0.5s;
        }
        .navigation ul li.active a .notification-dot {
            transform: translateY(-32px);
        }

        .modal-enter { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        
        .cookie-banner-enter { animation: slideUp 0.5s ease-out; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <main id="content-container" class="w-full max-w-sm mx-auto min-h-screen bg-gray-100 pb-24">
        <!-- VISTA 1: HOME (Feed principal) -->
        <div id="home-view" class="view p-2">
            <header class="p-2 sticky top-0 bg-gray-100/80 backdrop-blur-sm z-10 -m-2 mb-2 border-b">
                <h1 class="brand-font text-2xl text-center">Marimoligram</h1>
            </header>
            <!-- Contenedor dedicado para los posts -->
            <div id="feed-content" class="space-y-2"></div>
        </div>

        <!-- VISTA 2: PERFIL (del usuario principal) -->
        <div id="profile-view" class="view hidden bg-white"></div>
        
        <!-- VISTA 3: MENSAJES (Ahora con sub-vistas) -->
        <div id="messages-view" class="view hidden">
            <!-- Lista de conversaciones -->
            <div id="message-list-view" class="p-4 space-y-2">
                 <h1 class="text-xl font-bold text-center">Mensajes Directos</h1>
            </div>
            <!-- Detalle de una conversaci√≥n -->
            <div id="chat-detail-view" class="hidden h-full flex flex-col"></div>
        </div>

        <!-- VISTA 4: B√öSQUEDA / EXPLORAR -->
        <div id="search-view" class="view hidden p-1">
             <h1 class="text-xl font-bold text-center p-4">Explorar</h1>
             <div id="explore-grid" class="grid grid-cols-3 gap-1"></div>
        </div>

        <!-- VISTA 5: AJUSTES (INTERACTIVA) -->
        <div id="settings-view" class="view hidden">
            <!-- Men√∫ Principal de Ajustes -->
            <div id="settings-main-menu" class="p-4 space-y-3">
                <h1 class="text-xl font-bold text-center mb-4">Ajustes</h1>
                <div data-settings-target="privacy" class="bg-white rounded-lg p-4 font-semibold cursor-pointer hover:bg-gray-200 flex justify-between items-center"><span>Privacidad y Seguridad</span> <ion-icon name="chevron-forward-outline"></ion-icon></div>
                <div data-settings-target="activity" class="bg-white rounded-lg p-4 font-semibold cursor-pointer hover:bg-gray-200 flex justify-between items-center"><span>Actividad de inicio de sesi√≥n</span> <ion-icon name="chevron-forward-outline"></ion-icon></div>
                <div data-settings-target="passwords" class="bg-white rounded-lg p-4 font-semibold cursor-pointer hover:bg-gray-200 flex justify-between items-center"><span>Contrase√±as guardadas</span> <ion-icon name="chevron-forward-outline"></ion-icon></div>
                <div data-action="show-terms" class="bg-white rounded-lg p-4 font-semibold cursor-pointer hover:bg-gray-200 flex justify-between items-center"><span>T√©rminos y Condiciones</span> <ion-icon name="chevron-forward-outline"></ion-icon></div>
                <div class="bg-red-100 text-red-600 rounded-lg p-4 font-semibold cursor-pointer hover:bg-red-200">Cerrar Sesi√≥n</div>
            </div>
            <!-- Sub-vistas de Ajustes -->
            <div id="settings-privacy-view" class="settings-detail-view hidden p-4 space-y-4"></div>
            <div id="settings-activity-view" class="settings-detail-view hidden p-4 space-y-3"></div>
            <div id="settings-passwords-view" class="settings-detail-view hidden p-4 space-y-3"></div>
        </div>
    </main>

    <footer class="fixed bottom-0 left-0 right-0 z-20 navigation" id="navigation-menu">
        <ul>
            <li class="list active" data-view="home"><a><span class="icon"><ion-icon name="home-outline"></ion-icon></span></a></li>
            <li class="list" data-view="profile"><a><span class="icon"><ion-icon name="person-circle-outline"></ion-icon></span></a></li>
            <li class="list" data-view="messages"><a><span class="icon"><ion-icon name="paper-plane-outline"></ion-icon></span><div class="notification-dot"><span class="relative flex h-3 w-3"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span><span class="relative inline-flex rounded-full h-3 w-3 bg-red-500"></span></span></div></a></li>
            <li class="list" data-view="search"><a><span class="icon"><ion-icon name="search-outline"></ion-icon></span></a></li>
            <li class="list" data-view="settings"><a><span class="icon"><ion-icon name="settings-outline"></ion-icon></span></a></li>
            <div class="indicator"></div>
        </ul>
    </footer>

    <!-- MODALS -->
    <div id="modal-post" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-30 modal-enter"></div>
    <div id="modal-profile" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-30 modal-enter"></div>
    <div id="modal-terms" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-30 modal-enter"></div>
    <div id="modal-cookies-config" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-40 modal-enter"></div>

    <!-- BANNER DE COOKIES (DISE√ëO ENGA√ëOSO) -->
    <div id="cookie-banner" class="hidden fixed bottom-0 left-0 right-0 bg-gray-800 text-white p-4 z-50 cookie-banner-enter">
        <div class="max-w-sm mx-auto">
            <p class="text-sm mb-3">
                Usamos cookies para mejorar tu experiencia. Puedes 
                <a href="#" id="config-cookies-btn" class="underline text-gray-400 hover:text-white text-xs font-normal">configurar tus preferencias</a>
                o aceptar todas para continuar.
            </p>
            <div class="mt-4">
                <button id="accept-cookies-btn" class="w-full bg-pink-600 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded-lg">Aceptar Todo</button>
            </div>
        </div>
    </div>


<script>
    // --- BASE DE DATOS COMPLETA Y AMPLIADA ---
    const usersData = { 
        '@Alexploramundo': { avatar: 'img/ALXPFP.webp', name: 'Alex Rojo Soshal', bio: 'Explorando el mundo, un destino a la vez. #TravelLife', }, 
        '@LaurAventura': { avatar: 'img/LAU01.webp', name: 'Laura Monta√±ez', bio: 'La vida es mejor en la monta√±a. ‚õ∞Ô∏è‚ú®', }, 
        '@OfertasDeVerano': { avatar: 'img/OFEPFP.webp', name: 'Ofertas de Verano', bio: 'Publicidad.', }, 
        '@FoodieCarlos': { avatar: 'img/FOD01.webp', name: 'Carlos Foodie', bio: 'Probando cada plato de la ciudad. üçîüçïüåÆ', }, 
        '@TechieModerno': { avatar: 'img/TEC01.webp', name: 'David G.', bio: 'Unboxing the future. üíªüì±üöÄ', }, 
        '@CozyCouture': { avatar: 'img/COZPFP.webp', name: 'Moda Urbana & Co', bio: 'Publicidad.', }, 
        '@MamaExploraMundo': { avatar: 'img/MAM01.webp', name: 'Marisa', bio: 'Orgullosa madre de un viajero.', }, 
        '@CyberMemes': { avatar: 'img/CYBPFP.webp', name: 'Memes de Ciberseguridad', bio: 'Aprendiendo a protegerte, un meme a la vez. üòâ', }, 
        '@kai_posting': { avatar: 'img/KAIPFP.webp', name: 'Kai', bio: 'brainrot daily dose ‚ú® | viviendo en tu fyp rent free'},
        '@NoticiasAlMinuto24': { avatar: 'img/NOTPFP.webp', name: 'NoticiasAlMinuto24', bio: 'La verdad, al instante. ‚ö°' },
        '@VerdadDigital': { avatar: 'img/VERPFP.webp', name: 'Verdad Digital', bio: 'Fact-checker. Desmintiendo bulos.' },
        '@User12345': { avatar: 'img/USRPFP.webp', name: 'User12345', bio: '' },
        '@FotografoUrbano': { avatar: 'img/FOTPFP.webp', name: 'Javier R√≠os Foto', bio: 'Capturando la ciudad.' },
        '@LauraAvent√∫ra': { avatar: 'img/LAU01.webp', name: 'Laura Monta√±ez', bio: 'La vida es mejor en la monta√±a. ‚õ∞Ô∏è‚ú®' },
        '@Desconocido': { avatar: 'img/DESPFP.webp', name: 'Desconocido', bio: '' },
        '@ViajeroIncansable': { avatar: 'img/VIAPFP.webp', name: 'Viajero Incansable', bio: 'N√≥mada digital.'}, 
        '@SenderistaPro': { avatar: 'img/LAU02.webp', name: 'Pro Senderista', bio: 'Descubriendo rutas.'}, 
        '@SolYMar': { avatar: 'img/ALX03.webp', name: 'Sol y Mar', bio: 'Viviendo en la playa.'}, 
    };
    
    const postsData = [
        { id: 'mision', type: 'mission', title: 'MISI√ìN: Ciber-Detective', text: 'La cuenta de @Alexploramundo ha sido comprometida. Tu misi√≥n es investigar su perfil y el de sus amigos para descubrir todas las vulnerabilidades. Elabora un informe con tus hallazgos.' },
        { id: 'ALX01', type: 'post', author: '@Alexploramundo', image: 'img/ALX04.webp', caption: 'Estrenando mi nuevo rinc√≥n de trabajo. ¬°Creo que por fin he conseguido un setup productivo! #HomeOffice', timestamp: 'Hace 3 semanas', comments: [{ user: '@MamaExploraMundo', text: '¬°Qu√© ordenado todo, hijo! Pero ten cuidado con lo que se ve en las fotos.' }, { user: '@TechieModerno', text: '¬°Buen setup! ¬øQu√© monitor es?' }]},
        { id: 'ALX02', type: 'post', author: '@Alexploramundo', caption: 'A veces me pregunto si no comparto demasiado por aqu√≠. Es f√°cil olvidar cu√°nta gente puede ver tus publicaciones. Una reflexi√≥n nocturna nada m√°s. ü§î', timestamp: 'Hace 2 semanas', comments: [{ user: '@MamaExploraMundo', text: 'Haces bien en pensarlo, hijo.' }]},
        { id: 'ALX03', type: 'post', author: '@Alexploramundo', image: 'img/ALX03.webp', caption: '¬°Despidiendo un verano incre√≠ble! El mejor remedio para el estr√©s. #Verano2025 #Playa #PuraVida', timestamp: 'Hace 1 semana', comments: [{ user: '@SolYMar', text: 'La mejor terapia que existe.' }, { user: '@kai_posting', text: 'vaya vibe, bro' }]},
        { id: 'ALX04', type: 'post', author: '@Alexploramundo', image: 'img/ALX01.webp', caption: '¬°Qu√© emoci√≥n! Con el pasaporte reci√©n renovado, ya no hay excusas para el pr√≥ximo gran viaje. ¬°El mundo me espera! ‚úàÔ∏èüåç #TravelLife #NuevasAventuras', timestamp: 'Hace 2 d√≠as', comments: [{ user: '@LaurAventura', text: '¬°Qu√© envidia! ¬°A disfrutarlo mucho!' }, { user: '@ViajeroIncansable', text: '¬°Esa es la actitud! ¬øPr√≥ximo destino?' }] },
        { id: 'CYB01', type: 'post', author: '@CyberMemes', image: 'img/CYB01.webp', caption: '¬øA qui√©n no le ha pasado? Ese bot√≥n es mi mejor amigo.', timestamp: 'Hace 4 semanas', comments: [{ user: '@Alexploramundo', text: 'jajaja total! Aunque a m√≠ ya no me pasa. Tengo un truco: uso siempre mi plato favorito seguido de mi a√±o de nacimiento. ¬°Infalible ya no me olvido! ü§´' }]},
        { id: 'CYB02', type: 'post', author: '@CyberMemes', image: 'img/CYB02.webp', caption: 'Jeje Bendito modo inc√≥gnito. #Ciberseguridad', timestamp: 'Hace 1 semana', comments: [] },
        { id: 'FOD01', type: 'post', author: '@FoodieCarlos', image: 'img/FOD03.webp', caption: 'He encontrado el para√≠so en forma de croqueta. ¬°Ten√©is que probar este sitio! #Croquetas #TapasMadrid #Foodie', timestamp: 'Hace 1 semana', comments: [{ user: '@Alexploramundo', text: '¬°Vaya! ¬°Me encantan las croquetas! ¬°Son mi comida favorita sin duda!' }]},
        { id: 'FOD02', type: 'post', author: '@FoodieCarlos', caption: 'Debate serio: ¬øla tortilla de patatas con o sin cebolla? Abro mel√≥n. üçà', timestamp: 'Hace 3 semanas', comments: [{user: '@Alexploramundo', text: '¬°Con cebolla siempre! No hay debate posible.'}] },
        { id: 'FOD03', type: 'post', author: '@FoodieCarlos', image: 'img/FOD01.webp', caption: 'Nada como una buena paella para celebrar el fin de semana. ¬øSois de marisco o de carne? #Paella #ComidaEspa√±ola', timestamp: 'Hace 1 mes', comments: []},
        { id: 'KAI01', type: 'post', author: '@kai_posting', caption: 'literalmente, mi cerebro a las 3 am pensando: TUNG TUNG TUNG SAHUR!!! Ballerina Capuccina', timestamp: 'Hace 4 d√≠as', comments: [{user: '@TechieModerno', text: 'No entiendo la mitad de lo que dices, pero me hace gracia.'}, {user: '@User12345', text: 'Otro post sin sentido, para no variar.'}] },
        { id: 'KAI02', type: 'post', author: '@kai_posting', image: 'img/KAI05.webp', caption: 'new fit check ‚ú®', timestamp: 'Hace 2 meses', comments: [{ user: '@User12345', text: 'Vaya pintas, no s√© c√≥mo te atreves a subir esto' }, { user: '@kai_posting', text: '@User12345 lol, ok boomer' }]},
        { id: 'KAI03', type: 'post', author: '@kai_posting', caption: 'soy delulu pero al menos soy feliz', timestamp: 'Hace 1 semana', comments: [{user: '@User12345', text: '???'}]},
        { id: 'KAI04', type: 'post', author: '@kai_posting', image: 'img/KAI03.webp', caption: 'Real. #meme #pov #fyp', timestamp: 'Hace 2 semanas', comments: [{user: '@LaurAventura', text: 'jajaja me pasa'}, {user: '@User12345', text: 'Deja de subir tonter√≠as.'}] },
        { id: 'KAI05', type: 'post', author: '@kai_posting', caption: 'hoy me he cruzado con 3 NPCs seguidos con el mismo bug, es que ni se esfuerzan los devs', timestamp: 'Hace 3 semanas', comments: [{user: '@User12345', text: 'Habla normal.'}]},
        { id: 'KAI06', type: 'post', author: '@kai_posting', caption: "acabo de ver a un pavo en la calle con el corte del 7 y las TN... es que es canon, no puedo ser el √∫nico que lo ve.", timestamp: 'Hace 1 mes', comments: [{user: '@Alexploramundo', text: '¬øCorte del 7? Me he perdido algo en mis viajes üòÇ'}, {user: '@User12345', text: 'L√°stima de cuenta.'}] },
        { id: 'LAU01', type: 'post', author: '@LaurAventura', image: 'img/LAU03.webp', caption: 'Un d√≠a incre√≠ble de senderismo con mi amigo @Alexploramundo. ¬°Hay que repetir pronto! #Monta√±a #Amigos #Naturaleza', timestamp: 'Hace 3 d√≠as', comments: [{ user: '@Alexploramundo', text: '¬°Fot√≥n! ¬°Qu√© bien lo pasamos!' }, { user: '@SenderistaPro', text: '¬°Qu√© buena ruta! ¬øD√≥nde es?' }] },
        { id: 'LAU02', type: 'post', author: '@LaurAventura', image: 'img/LAU02.webp', caption: 'No hay dos atardeceres iguales. Agradecida por estos momentos. #Atardecer #Paz', timestamp: 'Hace 1 semana', comments: []},
        { id: 'LAU03', type: 'post', author: '@LaurAventura', image: 'img/LAU01.webp', caption: 'Ma√±ana de bici por la sierra. ¬°Aire puro y a recargar pilas!', timestamp: 'Hace 3 semanas', comments: []},
        { id: 'MAM01', type: 'post', author: '@MamaExploraMundo', image: 'img/MAM04.webp', caption: 'Mis rosas est√°n preciosas esta primavera. ¬°Un peque√±o para√≠so en casa!', timestamp: 'Hace 5 d√≠as', comments: [{ user: '@LaurAventura', text: '¬°Qu√© bonito, Marisa!' }] },
        { id: 'MAM02', type: 'post', author: '@MamaExploraMundo', caption: '¬°Qu√© orgullosa de mi @Alexploramundo! Siempre persiguiendo sus sue√±os por todo el mundo. ¬°Aunque a veces me da cada susto con su confianza!', timestamp: 'Hace 2 semanas', comments: [] },
        { id: 'MAM03', type: 'post', author: '@MamaExploraMundo', image: 'img/MAM02.webp', caption: 'Tarde de domingo haciendo mi famosa tarta de manzana. ¬°La casa huele de maravilla!', timestamp: 'Hace 3 semanas', comments: [{user: '@FoodieCarlos', text: '¬°Necesito esa receta, Marisa!'}]},
        { id: 'MAM04', type: 'post', author: '@MamaExploraMundo', image: 'img/MAM01.webp', caption: 'Comida familiar de domingo. ¬°Qu√© alegr√≠a tener a @Alexploramundo en casa, aunque sea por poco tiempo!', timestamp: 'Hace 2 meses', comments: [{user: '@FoodieCarlos', text: '¬°Qu√© pintaza tiene esa paella, Marisa!'}] },
        { id: 'MOD03', type: 'post', isAd: true, author: '@CozyCouture', image: 'img/MOD02.webp', caption: 'El estilo est√° en las calles. Encuentra tu look con nosotros. #ModaUrbana', timestamp: 'Hace 5 d√≠as', comments: [{user: '@FotografoUrbano', text: 'Hola, esa foto es m√≠a. Agradecer√≠a que me dieras cr√©dito o la retiraras.'}, { user: '@kai_posting', text: 'bro WTF' }] },
        { id: 'MOD02', type: 'post', isAd: true, author: '@CozyCouture', image: 'img/MOD01.webp', caption: 'Edici√≥n limitada. Consigue las tuyas antes de que se agoten. #Sneakers #Hype', timestamp: 'Hace 3 semanas', comments: [] },
        { id: 'MOD01', type: 'post', isAd: true, author: '@CozyCouture', image: 'img/MOD03.webp', caption: 'Nuevas Hoodies, CozyCouture. Comfort. Style. YOU. #ModaUrbana', timestamp: 'Hace 1 semana', comments: [] },
        { id: 'NOT01', type: 'post', author: '@NoticiasAlMinuto24', image: 'img/NOT01.webp', caption: '¬°√öLTIMA HORA! Un estudio de la Universidad Internacional revela que el uso del m√≥vil por m√°s de una hora al d√≠a activa propiedades magn√©ticas en el cuerpo. ¬°Los objetos met√°licos se nos pegan!', timestamp: 'Hace 1 mes', comments: [{user: '@VerdadDigital', text: 'Esto es FALSO. No existe esa "Universidad" y el estudio es un bulo. Fuentes fiables aqu√≠: <a href="verd-dig.html">\'VerdadDigital.com\'</a> No compartan.'}] },
        { id: 'NOT02', type: 'post', author: '@NoticiasAlMinuto24', image: 'img/NOT01.webp', caption: '¬°√öLTIMA HORA! Un estudio de la Universidad Internacional revela que el uso del m√≥vil por m√°s de una hora al d√≠a activa propiedades magn√©ticas en el cuerpo. ¬°Los objetos met√°licos se nos pegan!', timestamp: 'Hace 3 semanas', comments: [{user: '@MamaExploraMundo', text: '¬°Qu√© barbaridad! ¬°Con lo que usa mi hijo el m√≥vil! Avisar√© a la familia.'}, {user: '@User12345', text: 'Lo sab√≠a... yo notaba algo raro.'}] },
        { id: 'NOT03', type: 'post', author: '@NoticiasAlMinuto24', image: 'img/NOT01.webp', caption: '¬°√öLTIMA HORA! Un estudio de la Universidad Internacional revela que el uso del m√≥vil por m√°s de una hora al d√≠a activa propiedades magn√©ticas en el cuerpo. ¬°Los objetos met√°licos se nos pegan!', timestamp: 'Hace 4 d√≠as', comments: [{user: '@kai_posting', text: 'No se rick...'}] },
        { id: 'OFE01', type: 'post', isAd: true, author: '@OfertasDeVerano', image: 'img/OFE01.webp', caption: '¬øGanas de una escapada? Vuelos a toda Europa desde 19.99‚Ç¨. ¬°No dejes pasar la oportunidad!', timestamp: 'Hace 2 meses', comments: []},
        { id: 'OFE02', type: 'post', isAd: true, author: '@OfertasDeVerano', image: 'img/OFE02.webp', caption: '¬øA√∫n sin tus gafas de sol para este verano? ¬°Aprovecha nuestro 50% de descuento! Link en la bio. #Verano #Ofertas', timestamp: 'Hace 3 semanas', comments: [] },
        { id: 'TEC01', type: 'post', author: '@TechieModerno', image: 'img/TEC01.webp', caption: 'D√≠a de mantenimiento en el centro de datos. Aqu√≠ es donde vive la magia (y vuestros datos). #SysAdmin #DataCenter', timestamp: 'Hace 1 mes', comments: [] },
        { id: 'TEC02', type: 'post', author: '@TechieModerno', caption: 'Recordatorio amistoso: una VPN no te hace 100% an√≥nimo, pero es una capa de seguridad esencial hoy en d√≠a. ¬øCu√°l us√°is vosotros?', timestamp: 'Hace 4 semanas', comments: [] },
        { id: 'TEC03', type: 'post', author: '@TechieModerno', image: 'img/TEC03.webp', caption: 'Probando esta nueva bestia. ¬°La potencia es incre√≠ble! Review completa muy pronto en mi canal. #Tech #Review', timestamp: 'Hace 6 d√≠as', comments: [{ user: '@Alexploramundo', text: '¬°Wow! ¬°Tiene una pinta incre√≠ble!' }] },
        { id: 'FTO01', type: 'post', author: '@FotografoUrbano', image: 'img/FTO01.webp', caption: 'Luces de la ciudad. #FotografiaUrbana #StreetPhotography', timestamp: 'Hace 2 meses', comments: [{ user: '@kai_posting', text: 'tremendo foton, gracias bro' }] }
    ];
    
    const conversationsData = [ 
        { id: 'Aerovuela', participantName: 'AeroVuela Max', participantAvatar: 'img/DESPFP.webp', lastMessage: '¬°Muchas gracias!', messages: [ { sender: 'them', text: '¬°Felicidades @Alexploramundo! Eres el ganador de nuestro sorteo mensual. Para reclamar tu premio, necesitamos verificar tus datos. Por favor, inicia sesi√≥n en el siguiente portal seguro: <a href="aerovuelamax.html" class="text-blue-600 underline">bit.ly/vuelo-gratis-real</a>' }, { sender: 'me', text: '¬°Qu√© buena noticia! Claro, mis datos son: Alex Rojo Soshal, con DNI XMP200309. ¬°Muchas gracias!' } ] }, 
        { id: 'LauraV', participantName: '@LauraAvent√∫ra', participantAvatar: usersData['@LaurAventura'].avatar.replace('80x80','40x40'), lastMessage: '¬°Ahora mismo te lo mando! ¬øEst√°s bien?', messages: [ { sender: 'them', text: '¬°Hola √Ålex! Soy Laura. He perdido el m√≥vil y la cartera, estoy tirada. Necesito que me hagas un Bizum urgente de 50‚Ç¨ a este n√∫mero para poder coger un taxi a casa. ¬°Es una emergencia! Ya te lo devolver√©.'}, { sender: 'me', text: '¬°Claro, Laura! Qu√© faena. No te preocupes, ¬°ahora mismo te lo mando! ¬øEst√°s bien?' } ] },
        { id: 'DESC', participantName: '@Desconocido', participantAvatar: usersData['@Desconocido'].avatar, lastMessage: 'No s√© de qu√© hablas... ¬øpodemos hablarlo?', messages: [ { sender: 'them', text: 'Hola, Alex. Tengo un v√≠deo tuyo bastante comprometedor. O me pagas 200‚Ç¨ en criptomonedas o me asegurar√© de que todos tus seguidores lo vean. Tienes 24 horas.'}, { sender: 'me', text: '¬øQu√© v√≠deo? No s√© de qu√© hablas... Por favor, no hagas nada. ¬øPodemos hablarlo? No tengo tanto dinero.' } ] },
        { id: 'Laura', participantName: '@LaurAventura', participantAvatar: usersData['@LaurAventura'].avatar.replace('80x80','40x40'), lastMessage: '¬°Perfecto! ¬°Qu√© ganas!', messages: [ { sender: 'them', text: 'Oye, ¬°qu√© fotaza la que subiste el otro d√≠a en la monta√±a!' }, { sender: 'me', text: 'Verdad? Fue un d√≠a genial. A ver cu√°ndo repetimos.' }, { sender: 'them', text: '¬°Cuando quieras! Acabo de ver que has renovado el pasaporte... ¬øpr√≥ximo destino?' }, { sender: 'me', text: 'Jajaja, s√≠, ¬°por fin! Pues me voy a Jap√≥n dos semanas.' }, { sender: 'them', text: '¬°Qu√© pasada! Av√≠same cuando vuelvas y planeamos algo. ¬°Y tr√°eme mochis! üòÇ' }, { sender: 'me', text: '¬°Hecho! Los que quieras jajaja. ¬øHacemos una ruta por la Pedriza a la vuelta?'}, { sender: 'them', text: 'Uuuh, planazo. Me apunto de cabeza. ¬°Perfecto! ¬°Qu√© ganas!' } ] }, 
        { id: 'Mama', participantName: '@MamaExploraMundo', participantAvatar: usersData['@MamaExploraMundo'].avatar.replace('80x80','40x40'), lastMessage: 'Que s√≠ mam√°, de verdad, est√° todo controlado.', messages: [ { sender: 'them', text: 'Cari√±o, he visto la foto de tu nuevo despacho. ¬°Qu√© ordenado! Pero ten cuidado con los papelitos que se ven por ah√≠, que nunca se sabe.' }, { sender: 'me', text: 'Gracias, mam√°. No te preocupes, no es nada importante. Un beso.' }, { sender: 'them', text: 'M√°s vale prevenir, hijo. Que luego te llevas sustos. Por cierto, tambi√©n vi la foto del pasaporte. ¬°No pongas esas cosas en internet, que se ve tu nombre completo y la fecha de nacimiento!'}, { sender: 'me', text: 'Ay, es verdad... no me hab√≠a dado cuenta. Ahora la borro. Gracias por el aviso.'}, { sender: 'them', text: 'Si es que vas a lo loco. Ten m√°s cuidado, por favor.'}, { sender: 'me', text: 'Que s√≠ mam√°, de verdad, est√° todo controlado.' } ] },
        { id: 'Carlos', participantName: '@FoodieCarlos', participantAvatar: usersData['@FoodieCarlos'].avatar.replace('80x80','40x40'), lastMessage: '¬°Trato hecho! Te escribo.', messages: [ { sender: 'them', text: '¬°Hey, Alex! He visto que te molan las croquetas tanto como a m√≠.' }, { sender: 'me', text: '¬°Hombre, Carlos! Jajaja, s√≠, son mi perdici√≥n. Las de tu foto ten√≠an una pinta brutal.' }, { sender: 'them', text: 'Pues cuando te digo que son las mejores de Madrid, no exagero. Si quieres, cuando vuelvas de tus viajes, te llevo. ¬°Invita la casa!' }, { sender: 'me', text: '¬°Ostras, planazo! Vuelvo en un par de semanas de Jap√≥n. ¬øGuardas el secreto del sitio hasta entonces?' }, { sender: 'them', text: '¬°Trato hecho! Te escribo.' } ] },
        { id: 'Tec', participantName: '@TechieModerno', participantAvatar: usersData['@TechieModerno'].avatar.replace('80x80','40x40'), lastMessage: '¬°Claro! Cuando quieras le echamos un ojo.', messages: [ { sender: 'me', text: '¬°David! ¬°Qu√© pasada el port√°til que ense√±aste el otro d√≠a! Justo ando buscando algo as√≠ para los viajes, que el m√≠o ya no da para m√°s.' }, { sender: 'them', text: '¬°Buenas, Alex! Pues es una bestia, la verdad. Para editar v√≠deo y fotos mientras viajas, es perfecto. La bater√≠a dura bastante para la potencia que tiene.' }, { sender: 'me', text: 'Suena genial. ¬øCrees que es mejor que el nuevo Mac? Estoy en un mar de dudas.' }, { sender: 'them', text: 'Depende del uso que le des. Si quieres, cuando vuelvas por aqu√≠, te pasas por la oficina y lo pruebas sin compromiso. As√≠ sales de dudas.' }, { sender: 'me', text: '¬°Perfecto! Mil gracias, t√≠o.'}, { sender: 'them', text: '¬°Claro! Cuando quieras le echamos un ojo.' } ] }
    ];
    
    // --- REFERENCIAS AL DOM Y ESTADO ---
    const contentContainer = document.getElementById('content-container');
    const views = document.querySelectorAll('.view');
    const listItems = document.querySelectorAll('.list');
    const modalPostContainer = document.getElementById('modal-post');
    const modalProfileContainer = document.getElementById('modal-profile');
    const modalTermsContainer = document.getElementById('modal-terms');
    const modalCookiesConfigContainer = document.getElementById('modal-cookies-config');
    const cookieBanner = document.getElementById('cookie-banner');
    let activeModal = null;

    // --- L√ìGICA DE NAVEGACI√ìN Y VISTAS ---
    function switchView(viewId) {
        views.forEach(view => view.classList.add('hidden'));
        const targetView = document.getElementById(viewId + '-view');
        if (targetView) {
            targetView.classList.remove('hidden');
            contentContainer.scrollTop = 0;
            if (viewId === 'settings') showSettingsMenu();
            if (viewId === 'messages') showMessagesMenu();
        }
    }

    listItems.forEach(item => {
        item.addEventListener('click', function() {
            listItems.forEach(li => li.classList.remove('active'));
            this.classList.add('active');
            
            const allIcons = document.querySelectorAll('.navigation ul li a .icon ion-icon');
            allIcons.forEach(icon => { icon.setAttribute('name', icon.getAttribute('name').replace('-outline', '') + '-outline'); });
            const activeIcon = this.querySelector('.icon ion-icon');
            activeIcon.setAttribute('name', activeIcon.getAttribute('name').replace('-outline', ''));
            
            switchView(this.dataset.view);
        });
    });
    
    // --- L√ìGICA DE RENDERIZADO (FUNCIONES COMPLETAS) ---
    function renderFeed() {
        // CORRECCI√ìN: Apuntar al contenedor espec√≠fico de posts para no borrar el header.
        const feedContainer = document.getElementById('feed-content'); 
        if (!feedContainer) return; // Salir si el contenedor no existe

        // Funci√≥n para convertir timestamps a un valor comparable
        function parseTimestamp(timestamp) {
            if (!timestamp || timestamp === 'Patrocinado') return Infinity; 
            const parts = timestamp.split(' ');
            if (parts.length < 3) return Infinity; // Formato no esperado
            const value = parseInt(parts[1]);
            const unit = parts[2];
            if (unit.startsWith('d√≠a')) return value;
            if (unit.startsWith('semana')) return value * 7;
            if (unit.startsWith('mes')) return value * 30;
            return 0; // Para "hace X horas/minutos", etc.
        }

        // Ordenar postsData por antig√ºedad (de m√°s reciente a m√°s antiguo)
        const sortedPosts = [...postsData].sort((a, b) => {
            if (a.type === 'mission') return -1; // Misi√≥n siempre primero
            if (b.type === 'mission') return 1;
            return parseTimestamp(a.timestamp) - parseTimestamp(b.timestamp);
        });
        
        // CORRECCI√ìN: Construir todo el HTML en una cadena y luego asignarlo una vez para mayor eficiencia.
        let allPostsHTML = '';

        sortedPosts.forEach(post => { 
            let postHTML = ''; 
            if (post.type === 'mission') { 
                postHTML = `<div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded-lg shadow-md" role="alert"><p class="font-bold">${post.title}</p><p class="text-sm">${post.text}</p></div>`; 
            } else if (post.type === 'post') { 
                const authorData = usersData[post.author];
                if (!authorData) return; // Omitir post si el autor no existe
                const postFooter = `
                        <div class="p-3 pt-1 flex justify-between items-center text-gray-400">
                            <div class="flex items-center space-x-1 cursor-pointer hover:text-pink-600" data-post-id="${post.id}">
                                <ion-icon name="chatbubble-outline" class="text-xl"></ion-icon>
                                <span class="text-xs font-semibold">${post.comments ? post.comments.length : 0}</span>
                            </div>
                            <p class="text-xs">${post.timestamp}</p>
                        </div>`;

                postHTML = `
                        <div id="${post.id}" class="bg-white rounded-lg shadow-md overflow-hidden hover:ring-2 ring-pink-200 transition-all">
                            <div class="p-3 flex items-center justify-between">
                                <div class="flex items-center space-x-2 cursor-pointer" data-author-id="${post.author}">
                                    <img src="${authorData.avatar.replace('80x80','32x32')}" class="w-8 h-8 rounded-full" onerror="this.src='https://placehold.co/32x32/cccccc/ffffff?text=X'">
                                    <div>
                                        <span class="font-semibold text-sm">${post.author}</span>
                                        ${post.location ? `<p class="text-xs text-gray-500 flex items-center"><ion-icon name="location-sharp" class="mr-1"></ion-icon>${post.location}</p>` : ''}
                                    </div>
                                </div>
                                ${post.isAd ? `<span class="text-xs text-gray-400 font-medium">Patrocinado</span>` : ''}
                            </div>
                            ${post.image ? `<img src="${post.image}" class="w-full h-auto cursor-pointer" data-post-id="${post.id}" onerror="this.style.display='none'">` : ''}
                            <div class="p-3 pb-1">
                                <p class="text-sm"><strong class="font-semibold cursor-pointer" data-author-id="${post.author}">${post.author}</strong> ${post.caption}</p>
                            </div>
                            ${postFooter}
                        </div>`; 
            } 
            allPostsHTML += postHTML; 
        }); 

        feedContainer.innerHTML = allPostsHTML;
    }
    
    function renderProfile(authorId) { const user = usersData[authorId]; const userPosts = postsData.filter(p => p.author === authorId && p.type === 'post'); const profileContainer = document.getElementById('profile-view'); const postsGridHTML = userPosts.map(p => { if (p.image) { return `<div class="aspect-square bg-gray-200 cursor-pointer" data-post-id="${p.id}"><img src="${p.image}" class="w-full h-full object-cover"></div>`; } else { return `<div class="aspect-square bg-white border p-2 flex items-center justify-center cursor-pointer" data-post-id="${p.id}"><p class="text-xs text-center text-gray-600 overflow-hidden">${p.caption.substring(0, 50)}${p.caption.length > 50 ? '...' : ''}</p></div>`; } }).join(''); profileContainer.innerHTML = `<div class="p-4 flex flex-col items-center border-b bg-gray-50"><img src="${user.avatar}" class="w-20 h-20 rounded-full mb-2"><h2 class="font-bold text-lg">${authorId}</h2><p class="text-sm text-gray-600 text-center">${user.bio}</p><div class="flex space-x-8 mt-4 text-center"><div><p class="font-bold">${userPosts.length}</p><p class="text-xs text-gray-500">Posts</p></div><div><p class="font-bold">5.8K</p><p class="text-xs text-gray-500">Followers</p></div><div><p class="font-bold">210</p><p class="text-xs text-gray-500">Following</p></div></div></div><div class="grid grid-cols-3 gap-1 p-1">${postsGridHTML}</div>`; }
    function renderExploreGrid() { 
        function parseTimestamp(timestamp) {
            if (!timestamp || timestamp === 'Patrocinado') return Infinity; 
            const parts = timestamp.split(' ');
            if (parts.length < 3) return Infinity;
            const value = parseInt(parts[1]);
            const unit = parts[2];
            if (unit.startsWith('d√≠a')) return value;
            if (unit.startsWith('semana')) return value * 7;
            if (unit.startsWith('mes')) return value * 30;
            return 0;
        }

        const allPosts = postsData.filter(p => p.type === 'post');
        const sortedPosts = [...allPosts].sort((a, b) => parseTimestamp(a.timestamp) - parseTimestamp(b.timestamp));
        
        const exploreGrid = document.getElementById('explore-grid'); 
        exploreGrid.innerHTML = sortedPosts.map(p => { 
            if (p.image) { 
                return `<div class="aspect-square bg-gray-200 cursor-pointer" data-post-id="${p.id}"><img src="${p.image}" class="w-full h-full object-cover"></div>`; 
            } else { 
                return `<div class="aspect-square bg-white border p-2 flex items-center justify-center cursor-pointer" data-post-id="${p.id}"><p class="text-xs text-center text-gray-600 overflow-hidden">${p.caption.substring(0, 50)}${p.caption.length > 50 ? '...' : ''}</p></div>`; 
            } 
        }).join(''); 
    }
    function renderSettingsSubViews() { document.getElementById('settings-privacy-view').innerHTML = `<header class="flex items-center mb-6"><button data-action="back-to-settings" class="text-2xl mr-4"><ion-icon name="arrow-back-outline"></ion-icon></button><h2 class="text-xl font-bold">Privacidad y Seguridad</h2></header><div class="bg-white p-3 rounded-lg flex justify-between items-center"><span class="font-medium">Perfil Privado</span><span class="font-bold text-red-600">Desactivado</span></div><div class="bg-white p-3 rounded-lg flex justify-between items-center"><span class="font-medium">Etiquetado de Fotos</span><span class="font-bold text-yellow-600">Aprobaci√≥n Autom√°tica</span></div><div class="bg-white p-3 rounded-lg flex justify-between items-center"><span class="font-medium">Mostrar estado de actividad</span><span class="font-bold text-red-600">Activado</span></div><div class="bg-white p-3 rounded-lg flex justify-between items-center"><span class="font-medium">Autenticaci√≥n en dos pasos</span><span class="font-bold text-red-600">Desactivada</span></div>`; document.getElementById('settings-activity-view').innerHTML = `<header class="flex items-center mb-6"><button data-action="back-to-settings" class="text-2xl mr-4"><ion-icon name="arrow-back-outline"></ion-icon></button><h2 class="text-xl font-bold">Actividad de inicio de sesi√≥n</h2></header><div class="bg-green-100 p-3 rounded-lg"><p class="font-medium">Este dispositivo - Madrid, ES</p><p class="text-sm text-green-700">Activo ahora</p></div><div class="bg-white p-3 rounded-lg"><p class="font-medium">iPhone 14 - Kyoto, JP</p><p class="text-sm text-gray-600">Hace 1 d√≠a</p></div><div class="bg-red-100 p-3 rounded-lg"><p class="font-medium">Windows - Ubicaci√≥n desconocida</p><p class="text-sm text-red-700">Hace 3 horas</p></div>`; document.getElementById('settings-passwords-view').innerHTML = `<header class="flex items-center mb-6"><button data-action="back-to-settings" class="text-2xl mr-4"><ion-icon name="arrow-back-outline"></ion-icon></button><h2 class="text-xl font-bold">Contrase√±as guardadas</h2></header><div class="bg-white p-3 rounded-lg"><p class="font-medium">WIFI-AEROPUERTO-GRATIS</p><p class="text-sm text-gray-600">WIFIAEROPUERTO</p></div><div class="bg-yellow-100 border border-yellow-400 p-3 rounded-lg"><p class="font-medium">Red Social "FaceSnap"</p><p class="text-sm text-yellow-800">Croquetas2003</p></div>`; }
    
    // --- L√ìGICA DE MODALES ---
    function openModal(modalContainer, contentHTML) { closeCurrentModal(); modalContainer.innerHTML = contentHTML; modalContainer.classList.remove('hidden'); activeModal = modalContainer; }
    function closeCurrentModal() { if (activeModal) activeModal.classList.add('hidden'); activeModal = null; }
    function showPostModal(postId) { const post = postsData.find(p => p.id === postId); if (!post) return; const authorData = usersData[post.author]; const modalHTML = `<div class="bg-white rounded-2xl shadow-xl w-full max-w-md flex flex-col max-h-[90%]"><div class="p-3 flex items-center space-x-2 border-b"><img src="${authorData.avatar.replace('80x80','32x32')}" class="w-8 h-8 rounded-full"><span class="font-semibold text-sm">${post.author}</span></div><div class="overflow-y-auto">${post.image ? `<img src="${post.image}" class="w-full h-auto">` : ''}<div class="p-3"><p class="text-sm"><strong class="font-semibold">${post.author}</strong> ${post.caption}</p></div><div class="p-3 border-t space-y-2"><h3 class="font-bold text-sm mb-2">Comentarios</h3>${(post.comments && post.comments.length > 0) ? post.comments.map(c => `<div class="text-sm"><p><strong class="font-semibold cursor-pointer" data-author-id="${c.user}">${c.user}</strong> ${c.text}</p></div>`).join('') : '<p class="text-sm text-gray-500">No hay comentarios.</p>'}</div></div><div class="p-2 border-t mt-auto"><button onclick="closeCurrentModal()" class="w-full text-blue-600 font-semibold py-2">Cerrar</button></div></div>`; openModal(modalPostContainer, modalHTML); }
    function showProfileModal(authorId) { const user = usersData[authorId]; const userPosts = postsData.filter(p => p.author === authorId && p.type === 'post'); const postsGridHTML = userPosts.map(p => { if (p.image) { return `<div class="aspect-square bg-gray-200 cursor-pointer" data-post-id="${p.id}"><img src="${p.image}" class="w-full h-full object-cover"></div>`; } else { return `<div class="aspect-square bg-white border p-2 flex items-center justify-center cursor-pointer" data-post-id="${p.id}"><p class="text-xs text-center text-gray-600 overflow-hidden">${p.caption.substring(0, 50)}${p.caption.length > 50 ? '...' : ''}</p></div>`; } }).join(''); const modalHTML = `<div class="bg-white rounded-2xl shadow-xl w-full max-w-md flex flex-col max-h-[90%]"><div class="p-4 flex flex-col items-center border-b"><img src="${user.avatar}" class="w-20 h-20 rounded-full mb-2"><h2 class="font-bold text-lg">${authorId}</h2><p class="text-sm text-gray-600 text-center">${user.bio}</p></div><div class="overflow-y-auto p-1"><div class="grid grid-cols-3 gap-1">${postsGridHTML}</div></div><div class="p-2 border-t mt-auto"><button onclick="closeCurrentModal()" class="w-full text-blue-600 font-semibold py-2">Cerrar</button></div></div>`; openModal(modalProfileContainer, modalHTML); }
    function showTermsModal() { const modalHTML = `<div class="bg-white rounded-2xl shadow-xl w-full max-w-md flex flex-col max-h-[90%]"><div class="p-4 border-b"><h2 class="font-bold text-lg text-center">T√©rminos y Condiciones</h2></div><div class="overflow-y-auto p-4 text-sm space-y-2"><p>Al usar Marimoligram, aceptas que:</p><p class="font-bold text-red-600">1. Nos cedes los derechos de propiedad intelectual de todas tus fotos y v√≠deos para nuestro uso comercial sin compensaci√≥n.</p><p>2. Analizamos tus mensajes privados para mostrarte publicidad relevante.</p><p class="font-bold text-red-600">3. Nos reservamos el derecho de compartir tus datos de actividad con "terceros de confianza" para "mejorar el servicio".</p></div><div class="p-2 border-t mt-auto"><button onclick="closeCurrentModal()" class="w-full text-blue-600 font-semibold py-2">Cerrar</button></div></div>`; openModal(modalTermsContainer, modalHTML); }
    function showCookiesConfigModal() { 
        const modalHTML = `<div class="bg-white rounded-2xl shadow-xl w-full max-w-md flex flex-col max-h-[90%]">
            <div class="p-4 border-b"><h2 class="font-bold text-lg text-center">Configuraci√≥n de Cookies</h2></div>
            <div class="p-4 text-sm space-y-3">
                <div class="flex justify-between items-center"><label for="c-essential">Esenciales</label><input type="checkbox" id="c-essential" checked disabled class="h-5 w-5"></div>
                <div class="flex justify-between items-center"><label for="c-analytics" class="text-red-600 font-bold">An√°lisis y Rendimiento</label><input type="checkbox" id="c-analytics" checked class="h-5 w-5"></div>
                <div class="flex justify-between items-center"><label for="c-ads" class="text-red-600 font-bold">Publicidad y Seguimiento</label><input type="checkbox" id="c-ads" checked class="h-5 w-5"></div>
            </div>
            <div class="p-4 border-t mt-auto text-center space-y-3">
                <button id="close-config-and-return-btn" class="w-full bg-pink-600 text-white font-bold py-2 rounded-lg">Cerrar</button>
                <a href="#" id="save-cookies-config-link" class="text-xs text-gray-500 underline">Guardar preferencias y continuar</a>
            </div>
        </div>`;
        openModal(modalCookiesConfigContainer, modalHTML);
    }

    // --- L√ìGICA DE MENSAJES Y AJUSTES ---
    function showMessagesMenu() { document.getElementById('chat-detail-view').classList.add('hidden'); document.getElementById('message-list-view').classList.remove('hidden'); }
    function showChatDetail(conversationId) { const conversation = conversationsData.find(c => c.id === conversationId); const chatContainer = document.getElementById('chat-detail-view'); let messagesHTML = conversation.messages.map(msg => { if (msg.sender === 'me') { return `<div class="flex justify-end"><div class="bg-blue-500 text-white p-3 rounded-lg max-w-xs">${msg.text}</div></div>`; } else { return `<div class="flex justify-start"><div class="bg-white p-3 rounded-lg max-w-xs">${msg.text}</div></div>`; } }).join(''); chatContainer.innerHTML = `<header class="p-4 border-b bg-gray-50 flex items-center sticky top-0 z-10"><button data-action="back-to-messages" class="text-2xl mr-4"><ion-icon name="arrow-back-outline"></ion-icon></button><img src="${conversation.participantAvatar}" class="w-8 h-8 rounded-full mr-3"><h2 class="font-bold">${conversation.participantName}</h2></header><div class="p-4 space-y-4 flex-grow overflow-y-auto">${messagesHTML}</div>`; document.getElementById('message-list-view').classList.add('hidden'); chatContainer.classList.remove('hidden'); }
    function showSettingsDetail(viewName) { document.getElementById('settings-main-menu').classList.add('hidden'); const detailView = document.getElementById(`settings-${viewName}-view`); if(detailView) detailView.classList.remove('hidden'); }
    function showSettingsMenu() { document.querySelectorAll('.settings-detail-view').forEach(v => v.classList.add('hidden')); document.getElementById('settings-main-menu').classList.remove('hidden'); }

    // --- L√ìGICA DE COOKIES Y TEMA ---
    function applyCookieTheme() {
        const preference = localStorage.getItem('cookiePreference');
        const root = document.documentElement;
        if (preference === 'all') {
            root.style.setProperty('--clr', 'var(--clr-blue)');
        } else {
            root.style.setProperty('--clr', 'var(--clr-pink)');
        }
    }

    // --- DELEGACI√ìN DE EVENTOS ---
    document.addEventListener('click', (e) => { 
        const target = e.target; 
        if (target.closest('[data-post-id]')) showPostModal(target.closest('[data-post-id]').dataset.postId); 
        if (target.closest('[data-author-id]')) showProfileModal(target.closest('[data-author-id]').dataset.authorId); 
        const settingsTarget = target.closest('[data-settings-target]'); 
        if (settingsTarget) showSettingsDetail(settingsTarget.dataset.settingsTarget); 
        if (target.closest('[data-action="back-to-settings"]')) showSettingsMenu(); 
        if (target.closest('[data-action="show-terms"]')) showTermsModal(); 
        const conversationTarget = target.closest('[data-conversation-id]'); 
        if (conversationTarget) showChatDetail(conversationTarget.dataset.conversationId); 
        if (target.closest('[data-action="back-to-messages"]')) showMessagesMenu();
        if (target.closest('#close-config-and-return-btn')) {
            closeCurrentModal();
            cookieBanner.classList.remove('hidden');
        }
        if (target.closest('#save-cookies-config-link')) {
            e.preventDefault();
            const analyticsChecked = document.getElementById('c-analytics').checked;
            const adsChecked = document.getElementById('c-ads').checked;
            
            localStorage.setItem('cookiesAccepted', 'true');
            if (!analyticsChecked && !adsChecked) {
                localStorage.setItem('cookiePreference', 'configured');
            } else {
                localStorage.setItem('cookiePreference', 'all');
            }
            applyCookieTheme();
            closeCurrentModal();
            cookieBanner.classList.add('hidden');
        }
    });

    // --- INICIALIZACI√ìN ---
    document.addEventListener('DOMContentLoaded', () => {
        applyCookieTheme(); // Aplicar tema al cargar

        // L√≥gica de Cookies
        const cookiesAccepted = localStorage.getItem('cookiesAccepted');
        if (!cookiesAccepted) {
            cookieBanner.classList.remove('hidden');
        }
        document.getElementById('accept-cookies-btn').addEventListener('click', () => {
            localStorage.setItem('cookiesAccepted', 'true');
            localStorage.setItem('cookiePreference', 'all');
            applyCookieTheme();
            cookieBanner.classList.add('hidden');
        });
        document.getElementById('config-cookies-btn').addEventListener('click', (e) => {
            e.preventDefault();
            showCookiesConfigModal();
            cookieBanner.classList.add('hidden');
        });

        renderFeed();
        renderProfile('@Alexploramundo');
        renderExploreGrid();
        renderSettingsSubViews();
        const messageListView = document.getElementById('message-list-view').querySelector('h1').parentElement;
        conversationsData.forEach(convo => { const isPhishing = convo.id === 'phishing' || convo.id === 'impersonation' || convo.id === 'sextortion'; messageListView.innerHTML += `<div data-conversation-id="${convo.id}" class="flex items-center space-x-3 p-2 rounded-lg cursor-pointer ${isPhishing ? 'bg-red-100 hover:bg-red-200' : 'hover:bg-gray-200'}"><img src="${convo.participantAvatar}" class="w-12 h-12 rounded-full"><div><p class="font-bold">${convo.participantName}</p><p class="text-sm text-gray-600 truncate">${convo.lastMessage}</p></div></div>`; });
        
        const homeIcon = document.querySelector('.list.active .icon ion-icon');
        homeIcon.setAttribute('name', homeIcon.getAttribute('name').replace('-outline', ''));
    });
</script>

</body>
</html>



