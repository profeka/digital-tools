<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Repositorio de R√∫bricas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilo Neubrutalista */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f0f0;
        }
        .neubrutalist {
            background-color: #ffffff;
            border: 3px solid #000000;
            box-shadow: 6px 6px 0 #000000;
            border-radius: 8px;
        }
        .neubrutalist-button {
            background-color: #ffffff;
            border: 3px solid #000000;
            border-radius: 8px;
            font-weight: 600;
            padding: 10px 16px;
            transition: all 0.2s ease;
            box-shadow: 4px 4px 0 #000000;
        }
        .neubrutalist-button:hover {
            box-shadow: 2px 2px 0 #000000;
            transform: translate(2px, 2px);
        }
        .neubrutalist-button:active {
            box-shadow: 0 0 0 #000000;
            transform: translate(4px, 4px);
        }
        /* Modal */
        .modal {
            display: none; /* Oculto por defecto */
            position: fixed;
            z-index: 50;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            align-items: center;
            justify-content: center;
        }
        /* Estilos para la cabecera fija */
        .header-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        /* Estilos del Constructor */
        .input-constr {
            border: 2px solid #000;
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 1rem;
            box-shadow: 3px 3px 0 #000;
            transition: all 0.2s ease;
        }
        .input-constr:focus {
            outline: none;
            box-shadow: 1px 1px 0 #000;
            transform: translate(2px, 2px);
        }
        .tag-constr {
            display: inline-flex;
            align-items: center;
            background-color: #e0e0e0;
            border: 2px solid #000;
            border-radius: 6px;
            padding: 4px 8px;
            font-weight: 600;
            box-shadow: 2px 2px 0 #000;
        }
        .tag-constr button {
            margin-left: 8px;
            font-weight: bold;
            color: #ef4444; /* red-500 */
        }
        .tag-constr button:hover {
            color: #000;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <!-- NUEVO: Cabecera Fija -->
    <header class="fixed top-0 left-0 right-0 bg-white border-b-2 border-black p-3 z-50 header-shadow flex justify-between items-center">
        <!-- Lado Izquierdo: Navegaci√≥n -->
        <div class="flex gap-2">
            <a href="calif.html" id="repo-link-btn" class="neubrutalist-button bg-blue-300 hover:bg-blue-400 !py-2 !px-3 text-sm sm:text-base">
                &larr; Volver a Herramienta
            </a>
        </div>

        <!-- T√≠tulo Principal (Centro) -->
        <div id="header-main-title" class="flex-grow text-center">
            <h1 class="text-lg sm:text-xl font-bold truncate">Repositorio de R√∫bricas</h1>
        </div>

        <!-- Lado Derecho: Espaciador (para mantener centrado el t√≠tulo) -->
        <div class="w-36"> <!-- Ajustar ancho para que coincida con el bot√≥n izquierdo -->
        </div>
    </header>

    <!-- Contenido Principal -->
    <!-- CORRECCI√ìN: A√±adido mt-24 (margin-top: 6rem) para dejar espacio al men√∫ -->
    <div class="max-w-7xl mx-auto space-y-8 mt-24">
        
        <!-- Constructor de R√∫bricas -->
        <section class="neubrutalist p-5">
            <!-- CORRECCI√ìN: Contenedor de t√≠tulo y bot√≥n de colapsar -->
            <div class="flex justify-between items-center border-b-2 border-black pb-2 mb-4">
                <h2 class="text-3xl font-bold">Constructor de R√∫bricas</h2>
                <button id="toggle-constructor" class="neubrutalist-button !py-1 !px-3 text-sm bg-gray-200 hover:bg-gray-300">
                    Mostrar ‚ñº
                </button>
            </div>
            
            <!-- CORRECCI√ìN: Contenedor colapsable -->
            <div id="constructor-content" style="display: none;">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Columna 1: Entradas del Formulario -->
                    <div class="space-y-6">

                        <!-- 1. T√≠tulo de la R√∫brica -->
                        <div class="space-y-2">
                            <label for="c-title" class="text-lg font-bold">1. T√≠tulo de la R√∫brica</label>
                            <input type="text" id="c-title" class="input-constr w-full" placeholder="Ej: Test de Ciberseguridad">
                        </div>

                        <label class="text-lg font-bold">2. Criterios (CE) y Colores</label>
                        <div class="flex gap-2">
                            <input type="text" id="c-ce-id" class="input-constr w-1/3" placeholder="CE 3.3">
                            <input type="text" id="c-ce-title" class="input-constr w-1/3" placeholder="Identificar amenazas">
                            <input type="text" id="c-ce-color" class="input-constr w-1/3" placeholder="red">
                            <button id="c-ce-add" class="neubrutalist-button !p-2 !shadow-sm !border-2" title="A√±adir Criterio">+</button>
                        </div>
                        <div id="c-ce-list" class="flex flex-wrap gap-2 pt-2"></div>
                    </div>
                    
                    <!-- Secciones (Casos) -->
                    <div class="space-y-2">
                        <label class="text-lg font-bold">3. Secciones (Casos) y Colores</label>
                        <div class="flex gap-2">
                            <input type="text" id="c-s-id" class="input-constr w-1/3" placeholder="s1">
                            <input type="text" id="c-s-title" class="input-constr w-1/3" placeholder="Caso 1: Phishing">
                            <input type="text" id="c-s-color" class="input-constr w-1/3" placeholder="blue">
                            <button id="c-s-add" class="neubrutalist-button !p-2 !shadow-sm !border-2" title="A√±adir Secci√≥n">+</button>
                        </div>
                        <div id="c-s-list" class="flex flex-wrap gap-2 pt-2"></div>
                    </div>

                    <!-- √çtems de Evaluaci√≥n -->
                    <div class="space-y-4 neubrutalist p-4 !mt-8 border-2 border-black">
                        <h3 class="text-xl font-bold">4. A√±adir √çtems de Evaluaci√≥n</h3>
                        <div class="space-y-2">
                            <label for="c-i-id" class="font-semibold">ID del √çtem</label>
                            <input type="text" id="c-i-id" class="input-constr w-full" placeholder="Ej: c1.1 (debe ser √∫nico)">
                        </div>
                        <div class="space-y-2">
                            <label for="c-i-title" class="font-semibold">T√≠tulo del √çtem</label>
                            <input type="text" id="c-i-title" class="input-constr w-full" placeholder="Ej: Identifica Phishing">
                        </div>
                        <div class="space-y-2">
                            <label for="c-i-text" class="font-semibold">Descripci√≥n (Texto de ayuda)</label>
                            <input type="text" id="c-i-text" class="input-constr w-full" placeholder="Ej: Valora si...">
                        </div>
                        <div class="space-y-2">
                            <label for="c-i-points" class="font-semibold">Puntos</label>
                            <input type="number" id="c-i-points" class="input-constr w-full" placeholder="Ej: 0.5" step="0.25">
                        </div>
                        <div class="space-y-2">
                            <label for="c-i-section" class="font-semibold">Secci√≥n (ID de la Secci√≥n)</label>
                            <input type="text" id="c-i-section" class="input-constr w-full" placeholder="Ej: s1">
                        </div>
                        <div class="space-y-2">
                            <label for="c-i-criteria" class="font-semibold">Criterios (IDs separados por coma)</label>
                            <input type="text" id="c-i-criteria" class="input-constr w-full" placeholder="Ej: CE 3.3, CE 4.3">
                        </div>
                        <button id="c-i-add" class="neubrutalist-button w-full bg-blue-300 hover:bg-blue-400">A√±adir √çtem a la R√∫brica</button>
                    </div>
                </div>

                <!-- Columna 2: Resultado JSON -->
                <div class="space-y-4">
                    <h3 class="text-xl font-bold">5. Resultado JSON (Listo para copiar)</h3>
                    <p class="text-sm text-gray-600">Pega este c√≥digo en la variable `rubricasData` de este archivo (`rub_repo.html`) para guardarlo.</p>
                    <textarea id="c-output-json" class="w-full h-96 p-3 border-2 border-black rounded-lg bg-gray-100 font-mono text-sm" readonly></textarea>
                    <button id="c-copy-json" class="neubrutalist-button w-full bg-green-300 hover:bg-green-400">Copiar JSON</button>
                    <button id="c-reset-form" class="neubrutalist-button w-full bg-red-300 hover:bg-red-400 !mt-2">Limpiar Formulario</button>
                </div>
            </div>
        </section>

        <!-- Lista de R√∫bricas Guardadas -->
        <section>
            <h2 class="text-3xl font-bold mb-6">R√∫bricas Guardadas</h2>
            <div id="rubricas-container" class="space-y-6">
                <!-- Las r√∫bricas se generan aqu√≠ -->
            </div>
        </section>

    </div>

    <!-- Modal para copiar JSON -->
    <div id="json-modal" class="modal" style="display: none;">
        <div id="json-modal-overlay" class="fixed inset-0 bg-black opacity-60" style="z-index: -1;"></div>
        <div class="modal-content neubrutalist p-6 w-full max-w-2xl relative bg-white">
            <h3 class="text-2xl font-bold border-b-2 border-black pb-2 mb-4">C√≥digo JSON de la R√∫brica</h3>
            <button id="json-modal-close" class="absolute top-4 right-4 text-3xl font-bold hover:text-red-500">&times;</button>
            <textarea id="json-modal-textarea" readonly class="w-full h-96 p-3 border-2 border-black rounded-lg bg-gray-100 font-mono text-sm"></textarea>
            <button id="json-modal-copy" class="neubrutalist-button w-full mt-4 bg-blue-300 hover:bg-blue-400">Copiar al Portapapeles</button>
        </div>
    </div>

    <!-- Modal simple para Alertas -->
    <div id="simple-modal" class="modal" style="display: none;">
        <div id="simple-modal-overlay-alert" class="fixed inset-0 bg-black opacity-60" style="z-index: -1;"></div>
        <div class="neubrutalist p-6 w-full max-w-sm relative bg-white">
            <p id="simple-modal-message" class="text-gray-700 text-center text-lg">Mensaje de alerta.</p>
            <button id="simple-modal-close" class="neubrutalist-button w-full mt-6 bg-blue-300 hover:bg-blue-400">OK</button>
        </div>
    </div>


    <!-- DATOS DE LAS R√öBRICAS GUARDADAS -->
    <script>
        // --- BASE DE DATOS DE R√öBRICAS ---
        // (Aqu√≠ es donde a√±ades tus r√∫bricas generadas)
        const rubricasData = {
            "rubr_1_0": {
              "title": "1.0 Dec√°logo",
              "reportMap": {
                "s1": {
                  "title": "1. Evaluaci√≥n del Dec√°logo",
                  "color": "blue",
                  "isSection": true
                },
                "CE 4.1": {
                  "title": "CE 4.1: Uso √©tico y etiqueta digital",
                  "color": "purple",
                  "isSection": false
                }
              },
              "evaluationData": [
                {
                  "id": "d1.1",
                  "section": "s1",
                  "title": "1.1 Contenido y Relevancia üéØ",
                  "text": "Valora la pertinencia de las normas (3Ô∏è‚É£: 10 normas claras y pertinentes. 2Ô∏è‚É£: 7-9 normas o poco relevantes. 1Ô∏è‚É£: <7 normas o la mayor√≠a in√∫tiles).",
                  "points": 4.0,
                  "criteria": [
                    "CE 4.1"
                  ]
                },
                {
                  "id": "d1.2",
                  "section": "s1",
                  "title": "1.2 Claridad y Redacci√≥n ‚úçÔ∏è",
                  "text": "Valora la calidad de la redacci√≥n (3Ô∏è‚É£: Impecable, directa y concisa. 2Ô∏è‚É£: Confusa o con varios errores. 1Ô∏è‚É£: Numerosos errores, incomprensible).",
                  "points": 3.0,
                  "criteria": [
                    "CE 4.1"
                  ]
                },
                {
                  "id": "d1.3",
                  "section": "s1",
                  "title": "1.3 Organizaci√≥n y Estructura üß†",
                  "text": "Valora la estructura y presentaci√≥n (3Ô∏è‚É£: Perfecta, numerada y l√≥gica. 2Ô∏è‚É£: Adecuada, orden l√≥gico. 1Ô∏è‚É£: Ca√≥tica, sin orden).",
                  "points": 3.0,
                  "criteria": [
                    "CE 4.1"
                  ]
                }
              ]
            },
            "rubr_1_1": {
              "title": "1.1 Evaluaci√≥n Padlet: Amenazas en la Red",
              "reportMap": {
                "s1": {
                  "title": "1. Evaluaci√≥n de la Publicaci√≥n",
                  "color": "blue",
                  "isSection": true
                },
                "CE3.3": {
                  "title": "CE 3.3: Identificar y reaccionar ante amenazas en la red",
                  "color": "purple",
                  "isSection": false
                },
                "CE2.2": {
                  "title": "CE 2.2: Buscar y seleccionar informaci√≥n con sentido cr√≠tico",
                  "color": "green",
                  "isSection": false
                }
              },
              "evaluationData": [
                {
                  "id": "a1.1",
                  "section": "s1",
                  "title": "1.1 Identificaci√≥n y Precisi√≥n üéØ",
                  "text": "Valora la identificaci√≥n y definici√≥n de la amenaza. (3Ô∏è‚É£: Define con total precisi√≥n qu√© es y c√≥mo act√∫a. 2Ô∏è‚É£: Definici√≥n correcta pero b√°sica o algo confusa. 1Ô∏è‚É£: Definici√≥n incorrecta o no identifica la amenaza).",
                  "points": 3,
                  "criteria": [
                    "CE3.3"
                  ]
                },
                {
                  "id": "a1.2",
                  "section": "s1",
                  "title": "1.2 Medidas de Protecci√≥n üõ°Ô∏è",
                  "text": "Valora la descripci√≥n de las medidas de protecci√≥n. (3Ô∏è‚É£: Describe varias medidas espec√≠ficas (preventivas/correctivas) y explica por qu√© son eficaces. 2Ô∏è‚É£: Describe medidas correctas pero gen√©ricas. 1Ô∏è‚É£: No incluye medidas o no son adecuadas).",
                  "points": 3,
                  "criteria": [
                    "CE3.3"
                  ]
                },
                {
                  "id": "a1.3",
                  "section": "s1",
                  "title": "1.3 Calidad de las Fuentes üìö",
                  "text": "Valora la b√∫squeda y cita de fuentes. (3Ô∏è‚É£: Cita 2 o m√°s fuentes fiables (medios, empresas de seguridad) y las enlaza correctamente. 2Ô∏è‚É£: Cita 1 fuente fiable o de fiabilidad media. 1Ô∏è‚É£: No cita fuentes o usa fuentes de nula fiabilidad).",
                  "points": 2,
                  "criteria": [
                    "CE2.2"
                  ]
                },
                {
                  "id": "a1.4",
                  "section": "s1",
                  "title": "1.4 Claridad y Formato (Padlet) ‚úçÔ∏è",
                  "text": "Valora la calidad y estructura de la publicaci√≥n. (3Ô∏è‚É£: Publicaci√≥n muy clara, bien redactada y visualmente atractiva. 2Ô∏è‚É£: Publicaci√≥n comprensible pero escueta o desorganizada. 1Ô∏è‚É£: Publicaci√≥n incomprensible, desordenada o con graves errores).",
                  "points": 2,
                  "criteria": [
                    "CE2.2"
                  ]
                }
              ]
            },
            "rubr_1_2": {
              "title": "1.2 Infograf√≠a Digital (4¬∫ ESO)",
              "reportMap": {
                "s1": {
                  "title": "1. Evaluaci√≥n de la Infograf√≠a",
                  "color": "blue",
                  "isSection": true
                },
                "CE2.1": {
                  "title": "CE 2.1: Investigaci√≥n y Selecci√≥n",
                  "color": "green",
                  "isSection": false
                },
                "CE4.3": {
                  "title": "CE 4.3: S√≠ntesis y Claridad",
                  "color": "cyan",
                  "isSection": false
                },
                "CE2.2": {
                  "title": "CE 2.2: Dise√±o y Creaci√≥n",
                  "color": "orange",
                  "isSection": false
                },
                "CE4.1": {
                  "title": "CE 4.1: Uso √âtico y Fuentes",
                  "color": "purple",
                  "isSection": false
                }
              },
              "evaluationData": [
                {
                  "id": "i1.1",
                  "section": "s1",
                  "title": "1.1 Investigaci√≥n y Selecci√≥n",
                  "text": "Valora la relevancia y fiabilidad de las fuentes (4pts = Sobresaliente)",
                  "points": 4,
                  "criteria": [
                    "CE2.1"
                  ]
                },
                {
                  "id": "i1.2",
                  "section": "s1",
                  "title": "1.2 S√≠ntesis y Claridad",
                  "text": "Valora la capacidad de s√≠ntesis y la estructura l√≥gica (4pts = Sobresaliente)",
                  "points": 4,
                  "criteria": [
                    "CE4.3"
                  ]
                },
                {
                  "id": "i1.3",
                  "section": "s1",
                  "title": "1.3 Dise√±o y Creaci√≥n",
                  "text": "Valora el dise√±o, equilibrio y uso de elementos (4pts = Sobresaliente)",
                  "points": 4,
                  "criteria": [
                    "CE2.2"
                  ]
                },
                {
                  "id": "i1.4",
                  "section": "s1",
                  "title": "1.4 Uso √âtico y Fuentes",
                  "text": "Valora la correcta citaci√≥n de fuentes y respeto a P.I. (4pts = Sobresaliente)",
                  "points": 4,
                  "criteria": [
                    "CE4.1"
                  ]
                }
              ]
            },
            // --- INICIO DE LA CORRECCI√ìN (A√ëADIENDO 1.3 y 1.4) ---
            "rubr_1_3": {
              "title": "1.3 Test de la Academia de Ciberseguridad",
              "reportMap": {
                "s1": {"title": "Caso 1: Email Amazon", "color": "blue", "isSection": true},
                "s2": {"title": "Caso 2: WhatsApp Fiesta", "color": "green", "isSection": true},
                "s3": {"title": "Caso 3: Sorteo Instagram", "color": "yellow", "isSection": true},
                "s4": {"title": "Caso 4: Dilema Copyright", "color": "purple", "isSection": true},
                "s5": {"title": "Caso 5: Netiqueta/Ciberacoso", "color": "teal", "isSection": true},
                "s6": {"title": "Caso 6: Email del Banco", "color": "orange", "isSection": true},
                "CE 3.3": {"title": "CE 3.3: Identificar amenazas", "color": "red", "isSection": false},
                "CE 4.1": {"title": "CE 4.1: Uso √©tico, P.I.", "color": "lime", "isSection": false},
                "CE 4.3": {"title": "CE 4.3: Analizar cr√≠ticamente", "color": "cyan", "isSection": false}
              },
              "evaluationData": [
                {"id": "c1.1", "section": "s1", "title": "1.1. Identifica Phishing (Amazon)", "text": "Identifica el correo como Phishing o amenaza.", "points": 0.5, "criteria": ["CE 3.3", "CE 4.3"]},
                {"id": "c1.2", "section": "s1", "title": "1.2. Banderas Rojas (Amazon)", "text": "Menciona al menos una bandera roja (Ej: URL http://..., dominio .co, saludo gen√©rico, urgencia).", "points": 0.5, "criteria": ["CE 3.3", "CE 4.3"]},
                {"id": "c2.1", "section": "s2", "title": "2.1. Identifica Scam (WhatsApp)", "text": "Identifica el mensaje como Scam/Fraude/Phishing.", "points": 0.5, "criteria": ["CE 3.3", "CE 4.3"]},
                {"id": "c2.2", "section": "s2", "title": "2.2. Banderas Rojas (WhatsApp)", "text": "Menciona al menos una bandera roja (Ej: URL .tk, pide datos personales, desconocido).", "points": 0.5, "criteria": ["CE 3.3", "CE 4.3"]},
                {"id": "c3.1", "section": "s3", "title": "3.1. Identifica Scam (Instagram)", "text": "Identifica la cuenta como Scam/Fraude/Robo de datos.", "points": 0.5, "criteria": ["CE 3.3", "CE 4.3"]},
                {"id": "c3.2", "section": "s3", "title": "3.2. Banderas Rojas (Instagram)", "text": "Menciona al menos una bandera roja (Ej: cuenta nueva, pocos seguidores, link externo).", "points": 0.5, "criteria": ["CE 3.3", "CE 4.3"]},
                {"id": "c4.1", "section": "s4", "title": "4.1. Uso de Contenido (No)", "text": "Responde \"No\" a si se puede usar sin m√°s.", "points": 0.5, "criteria": ["CE 4.1", "CE 4.3"]},
                {"id": "c4.2", "section": "s4", "title": "4.2. Citar Fuente (M√≠nimo)", "text": "Identifica que lo M√çNIMO es citar al autor o la fuente.", "points": 0.5, "criteria": ["CE 4.1", "CE 4.3"]},
                {"id": "c4.3", "section": "s4", "title": "4.3. Licencia (Correcto)", "text": "Explica que lo CORRECTO es buscar la licencia (Ej: Creative Commons) o pedir permiso.", "points": 1.0, "criteria": ["CE 4.1", "CE 4.3"]},
                {"id": "c5.1", "section": "s5", "title": "5.1. Identifica Netiqueta", "text": "Responde \"No\" a si es aceptable (o explica que viola la netiqueta).", "points": 0.5, "criteria": ["CE 4.1", "CE 4.3"]},
                {"id": "c5.2", "section": "s5", "title": "5.2. Propone Acciones", "text": "Propone dos acciones coherentes (Ej: 1. Hablar en privado, 2. Apoyar al compa√±ero, 3. Reportar).", "points": 1.0, "criteria": ["CE 4.1", "CE 4.3"]},
                {"id": "c5.3", "section": "s5", "title": "5.3. Justifica Elecci√≥n", "text": "Justifica brevemente su elecci√≥n de la \"m√°s correcta\".", "points": 0.5, "criteria": ["CE 4.1", "CE 4.3"]},
                {"id": "c6.1", "section": "s6", "title": "6.1. TRES Banderas Rojas (Banco)", "text": "Nombra TRES banderas rojas evidentes (Ej: Dominio .biz, saludo gen√©rico, pide DNI + clave, urgencia).", "points": 1.5, "criteria": ["CE 3.3", "CE 4.3"]},
                {"id": "c6.2", "section": "s6", "title": "6.2. Acci√≥n Correcta (Banco)", "text": "Indica que la √∫nica acci√≥n correcta es Borrarlo / Marcarlo como Spam (y no hacer clic).", "points": 1.5, "criteria": ["CE 3.3", "CE 4.3"]}
              ]
            },
            "rubr_1_4": {
              "title": "1.4 Informe de Ciberdetective (Marimoligram)",
              "reportMap": {
                "s1": {"title": "1. An√°lisis del Perfil", "color": "blue", "isSection": true},
                "s2": {"title": "2. An√°lisis de Interacciones", "color": "green", "isSection": true},
                "s3": {"title": "3. Auditor√≠a de Configuraci√≥n", "color": "yellow", "isSection": true},
                "s4": {"title": "4. Conclusiones y Plan de Acci√≥n", "color": "purple", "isSection": true},
                "CE 1.3": {"title": "CE 1.3: Resolver problemas t√©cnicos", "color": "pink", "isSection": false},
                "CE 3.1": {"title": "CE 3.1: Proteger datos personales", "color": "red", "isSection": false},
                "CE 3.2": {"title": "CE 3.2: Gesti√≥n de seguridad", "color": "indigo", "isSection": false},
                "CE 3.3": {"title": "CE 3.3: Identificar amenazas", "color": "orange", "isSection": false},
                "CE 4.1": {"title": "CE 4.1: Uso √©tico, P.I.", "color": "lime", "isSection": false},
                "CE 4.3": {"title": "CE 4.3: Analizar cr√≠ticamente info", "color": "cyan", "isSection": false},
                "CEsp 4": {"title": "CEsp 4: Ciudadan√≠a digital cr√≠tica", "color": "teal", "isSection": false}
              },
              "evaluationData": [
                {"id": "p1.1", "section": "s1", "title": "1.1. Fuga de Info. Personal", "text": "Valora si el alumno identifica la gravedad de exponer datos sensibles (DNI/Pasaporte) y lo conecta con el riesgo de suplantaci√≥n.", "points": 1.0, "criteria": ["CE 3.1"]},
                {"id": "p1.2", "section": "s1", "title": "1.2. Huella Digital y Seguridad F√≠sica", "text": "Valora si el alumno conecta la informaci√≥n aparentemente inofensiva (gustos, planes de viaje) con riesgos reales (ingenier√≠a social, robo).", "points": 1.0, "criteria": ["CE 3.1"]},
                {"id": "p1.3", "section": "s1", "title": "1.3. Gesti√≥n de Contrase√±as", "text": "Valora si el alumno explica por qu√© el m√©todo es inseguro (predecible, basado en info p√∫blica), no solo si adivina la clave.", "points": 0.5, "criteria": ["CE 3.2"]},
                {"id": "p2.1", "section": "s2", "title": "2.1. Mensajes Directos (Amenazas)", "text": "Valora si el alumno nombra y diferencia correctamente las amenazas (Phishing, Suplantaci√≥n, Extorsi√≥n) y entiende su mecanismo.", "points": 1.5, "criteria": ["CE 3.3"]},
                {"id": "p2.2", "section": "s2", "title": "2.2. Noticias Falsas (Fake News)", "text": "Valora si el alumno aplica un m√©todo de verificaci√≥n (ej. contrastar, @VerdadDigital) y no solo \"sabe\" que es falsa.", "points": 0.5, "criteria": ["CE 4.3"]},
                {"id": "p2.3", "section": "s2", "title": "2.3. Propiedad Intelectual", "text": "Valora si el alumno identifica el conflicto (uso comercial sin permiso) y entiende el concepto de \"derechos de autor\".", "points": 0.5, "criteria": ["CE 4.1"]},
                {"id": "p2.4", "section": "s2", "title": "2.4. Ciberacoso y Etiqueta", "text": "Valora si el alumno identifica los roles (acosador/v√≠ctima) y define el problema (ciberacoso) usando la \"etiqueta digital\".", "points": 0.5, "criteria": ["CE 4.1"]},
                {"id": "p3.1", "section": "s3", "title": "3.1. Actividad de Inicio de Sesi√≥n", "text": "Valora si el alumno identifica el problema t√©cnico (sesi√≥n extra√±a) y propone la soluci√≥n completa (Cerrar sesi√≥n Y cambiar clave).", "points": 1.0, "criteria": ["CE 1.3"]},
                {"id": "p3.2", "section": "s3", "title": "3.2. Contrase√±as Guardadas", "text": "Valora si el alumno identifica el riesgo cr√≠tico de la REUTILIZACI√ìN de contrase√±as (acceso al banco, email, etc.).", "points": 0.5, "criteria": ["CE 3.2"]},
                {"id": "p3.3", "section": "s3", "title": "3.3. T&C y Patrones Oscuros", "text": "Valora si el alumno detecta la intencionalidad del dise√±o (Patr√≥n Oscuro) o las cl√°usulas que vulneran su privacidad.", "points": 0.5, "criteria": ["CE 4.3"]},
                {"id": "p4.1", "section": "s4", "title": "4.1. Resumen de Riesgos", "text": "Valora la capacidad de s√≠ntesis del alumno para enumerar los riesgos y priorizarlos por gravedad (alto/medio/bajo).", "points": 0.5, "criteria": ["CE 3.1", "CE 3.3", "CE 4.3"]},
                {"id": "p4.2", "section": "s4", "title": "4.2. Medidas Correctoras", "text": "Valora si las 5+ medidas propuestas son concretas, eficaces y realistas (ej. 2FA, borrar fotos, bloquear, claves √∫nicas).", "points": 1.0, "criteria": ["CE 3.1", "CE 3.2"]},
                {"id": "p4.3", "section": "s4", "title": "4.3. Reflexi√≥n Final", "text": "Valora si la reflexi√≥n es personal, coherente y conecta la actividad con la importancia de la ciudadan√≠a digital cr√≠tica.", "points": 1.0, "criteria": ["CEsp 4"]}
              ]
            }
            // --- FIN DE LA CORRECCI√ìN ---
        };

        
        document.addEventListener('DOMContentLoaded', () => {
            
            let constructorData = {
                title: "",
                reportMap: {},
                evaluationData: []
            };

            const rubricasContainer = document.getElementById('rubricas-container');
            const jsonModal = document.getElementById('json-modal');
            const jsonModalTextarea = document.getElementById('json-modal-textarea');
            const simpleModal = document.getElementById('simple-modal');
            const simpleModalMessage = document.getElementById('simple-modal-message');

            const toggleButton = document.getElementById('toggle-constructor');
            const constructorContent = document.getElementById('constructor-content');
            toggleButton.addEventListener('click', () => {
                const isHidden = constructorContent.style.display === 'none';
                if (isHidden) {
                    constructorContent.style.display = 'block';
                    toggleButton.innerText = 'Ocultar ‚ñ≤';
                } else {
                    constructorContent.style.display = 'none';
                    toggleButton.innerText = 'Mostrar ‚ñº';
                }
            });


            // --- Funciones de Modales ---
            function showJsonModal(jsonString) {
                jsonModalTextarea.value = jsonString;
                jsonModal.style.display = 'flex';
            }
            function hideJsonModal() {
                jsonModal.style.display = 'none';
            }
            function showSimpleMessage(message) {
                simpleModalMessage.innerText = message;
                simpleModal.style.display = 'flex';
            }
            function hideSimpleMessage() {
                simpleModal.style.display = 'none';
            }

            document.getElementById('json-modal-close').addEventListener('click', hideJsonModal);
            document.getElementById('json-modal-overlay').addEventListener('click', hideJsonModal);
            document.getElementById('json-modal-copy').addEventListener('click', () => {
                jsonModalTextarea.select();
                document.execCommand('copy');
                showSimpleMessage("¬°JSON copiado al portapapeles!");
                setTimeout(hideSimpleMessage, 1500);
            });
            document.getElementById('simple-modal-close').addEventListener('click', hideSimpleMessage);
            document.getElementById('simple-modal-overlay-alert').addEventListener('click', hideSimpleMessage);

            // --- L√≥gica del Constructor ---
            const c = { // Objeto para IDs del constructor
                title: document.getElementById('c-title'),
                ceId: document.getElementById('c-ce-id'),
                ceTitle: document.getElementById('c-ce-title'),
                ceColor: document.getElementById('c-ce-color'),
                ceAdd: document.getElementById('c-ce-add'),
                ceList: document.getElementById('c-ce-list'),
                sId: document.getElementById('c-s-id'),
                sTitle: document.getElementById('c-s-title'),
                sColor: document.getElementById('c-s-color'),
                sAdd: document.getElementById('c-s-add'),
                sList: document.getElementById('c-s-list'),
                iId: document.getElementById('c-i-id'),
                iTitle: document.getElementById('c-i-title'),
                iText: document.getElementById('c-i-text'),
                iPoints: document.getElementById('c-i-points'),
                iSection: document.getElementById('c-i-section'),
                iCriteria: document.getElementById('c-i-criteria'),
                iAdd: document.getElementById('c-i-add'),
                output: document.getElementById('c-output-json'),
                copy: document.getElementById('c-copy-json'),
                reset: document.getElementById('c-reset-form')
            };

            // Funci√≥n para actualizar el JSON de salida
            function updateOutput() {
                // CORRECCI√ìN: Comprobar si c.title existe
                if (c.title) {
                    constructorData.title = c.title.value;
                }
                c.output.value = JSON.stringify(constructorData, null, 4);
            }

            // Funci√≥n para crear un tag visual
            function createTag(id, text, listEl, mapKey) {
                const tag = document.createElement('div');
                tag.className = 'tag-constr';
                tag.innerHTML = `<span>${text}</span>`;
                const delBtn = document.createElement('button');
                delBtn.innerText = '√ó';
                delBtn.onclick = () => {
                    tag.remove();
                    delete constructorData.reportMap[id];
                    // Eliminar √≠tems que usaban una secci√≥n eliminada
                    if (mapKey === 'isSection') {
                        constructorData.evaluationData = constructorData.evaluationData.filter(item => item.section !== id);
                    }
                    updateOutput();
                };
                tag.appendChild(delBtn);
                listEl.appendChild(tag);
            }

            // A√±adir Criterio (CE)
            c.ceAdd.addEventListener('click', () => {
                const id = c.ceId.value.trim();
                const title = c.ceTitle.value.trim();
                const color = c.ceColor.value.trim();
                if (!id || !title || !color) {
                    showSimpleMessage("Rellena ID, T√≠tulo y Color del Criterio.");
                    return;
                }
                constructorData.reportMap[id] = { title: title, color: color, isSection: false };
                createTag(id, `${id} (${title})`, c.ceList, false);
                c.ceId.value = c.ceTitle.value = c.ceColor.value = '';
                updateOutput();
            });

            // A√±adir Secci√≥n (Caso)
            c.sAdd.addEventListener('click', () => {
                const id = c.sId.value.trim();
                const title = c.sTitle.value.trim();
                const color = c.sColor.value.trim();
                if (!id || !title || !color) {
                    showSimpleMessage("Rellena ID, T√≠tulo y Color de la Secci√≥n.");
                    return;
                }
                constructorData.reportMap[id] = { title: title, color: color, isSection: true };
                createTag(id, `${id} (${title})`, c.sList, true);
                c.sId.value = c.sTitle.value = c.sColor.value = '';
                updateOutput();
            });

            // A√±adir √çtem de Evaluaci√≥n
            c.iAdd.addEventListener('click', () => {
                const item = {
                    id: c.iId.value.trim(),
                    title: c.iTitle.value.trim(),
                    text: c.iText.value.trim(),
                    points: parseFloat(c.iPoints.value),
                    section: c.iSection.value.trim(),
                    criteria: c.iCriteria.value.split(',').map(s => s.trim())
                };

                if (!item.id || !item.title || !item.points || !item.section || item.criteria.length === 0) {
                    showSimpleMessage("Rellena todos los campos del √çtem de Evaluaci√≥n.");
                    return;
                }
                
                // Validar que la secci√≥n exista
                if (!constructorData.reportMap[item.section] || !constructorData.reportMap[item.section].isSection) {
                    showSimpleMessage(`Error: La secci√≥n "${item.section}" no existe. Cr√©ala primero en el paso 3.`);
                    return;
                }

                // Validar que los criterios existan
                for (const ce of item.criteria) {
                    if (!constructorData.reportMap[ce] || constructorData.reportMap[ce].isSection) {
                        showSimpleMessage(`Error: El criterio "${ce}" no existe. Cr√©alo primero en el paso 2.`);
                        return;
                    }
                }
                
                // Validar ID √∫nico
                if (constructorData.evaluationData.some(i => i.id === item.id)) {
                    showSimpleMessage(`Error: El ID de √≠tem "${item.id}" ya existe.`);
                    return;
                }
                
                constructorData.evaluationData.push(item);
                showSimpleMessage(`¬°√çtem "${item.title}" a√±adido con √©xito!`);
                
                // Limpiar formulario de √≠tem
                c.iId.value = c.iTitle.value = c.iText.value = c.iPoints.value = c.iSection.value = c.iCriteria.value = '';
                
                updateOutput();
            });
            
            // Eventos de T√≠tulo y Botones
            if (c.title) {
                c.title.addEventListener('input', updateOutput);
            }

            c.copy.addEventListener('click', () => {
                if (!c.output.value) return;
                c.output.select();
                document.execCommand('copy');
                showSimpleMessage("¬°JSON copiado al portapapeles!");
            });
            c.reset.addEventListener('click', () => {
                constructorData = { title: "", reportMap: {}, evaluationData: [] };
                if (c.title) c.title.value = '';
                c.ceList.innerHTML = '';
                c.sList.innerHTML = '';
                c.output.value = '';
            });


            // --- L√≥gica para Mostrar R√∫bricas Guardadas ---
            function renderRubricas() {
                rubricasContainer.innerHTML = '';
                
                if (Object.keys(rubricasData).length === 0) {
                    rubricasContainer.innerHTML = '<p class="text-gray-600">No hay r√∫bricas guardadas. ¬°Crea una con el constructor!</p>';
                    return;
                }
                
                // CORRECCI√ìN: Ordenar las claves (keys) antes de renderizar
                const sortedKeys = Object.keys(rubricasData).sort();

                for (const key of sortedKeys) { // Usar las claves ordenadas
                    const rubrica = rubricasData[key];
                    const rubricaEl = document.createElement('div');
                    rubricaEl.className = 'neubrutalist p-5';
                    
                    // Extraer Criterios
                    const criterios = Object.keys(rubrica.reportMap)
                        .filter(k => !rubrica.reportMap[k].isSection)
                        .map(k => `<span class="text-xs font-semibold px-2 py-0.5 rounded-full border-2 border-black bg-${rubrica.reportMap[k].color}-200 text-black">${k}</span>`)
                        .join(' ');
                    
                    rubricaEl.innerHTML = `
                        <div class="flex justify-between items-start">
                            <h3 class="text-2xl font-bold">${rubrica.title}</h3>
                            <span class="font-mono text-sm text-gray-500 bg-gray-100 p-1 border border-gray-300 rounded">${key}</span>
                        </div>
                        <div class="mt-3">
                            <h4 class="font-semibold mb-2">Criterios de Evaluaci√≥n:</h4>
                            <div class="flex flex-wrap gap-2">
                                ${criterios || '<span class="text-sm text-gray-500">No definidos</span>'}
                            </div>
                        </div>
                        <button data-key="${key}" class="copy-json-btn neubrutalist-button bg-blue-300 hover:bg-blue-400 mt-4">
                            Copiar C√≥digo JSON
                        </button>
                    `;
                    rubricasContainer.appendChild(rubricaEl);
                }

                // Asignar eventos a los botones de copiar
                document.querySelectorAll('.copy-json-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const key = e.target.dataset.key;
                        const jsonString = JSON.stringify(rubricasData[key], null, 4);
                        showJsonModal(jsonString);
                    });
                });
            }

            // Inicializar
            renderRubricas();
            if (c.title) {
                updateOutput();
            }
        });
    </script>
</body>
</html>
