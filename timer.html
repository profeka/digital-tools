<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Timer de Aula Seguro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@700&family=Nunito:wght@400;800&display=swap" rel="stylesheet">
    <style>
        /* Forzamos que lo oculto est√© oculto */
        .force-hidden {
            display: none !important;
            visibility: hidden !important;
            pointer-events: none !important;
        }

        body {
            font-family: 'Nunito', sans-serif;
            transition: background-color 1s ease;
            overscroll-behavior: none; 
            -webkit-tap-highlight-color: transparent;
        }
        
        .timer-nums {
            font-family: 'JetBrains Mono', monospace;
            font-variant-numeric: tabular-nums;
        }

        /* Animaci√≥n suave de "respiraci√≥n" para el estado de alerta */
        @keyframes breathe {
            0% { background-color: #ef4444; }
            50% { background-color: #991b1b; }
            100% { background-color: #ef4444; }
        }

        .pulse-bg {
            animation: breathe 3s infinite ease-in-out;
        }

        /* Animaci√≥n del emoji */
        @keyframes shake {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(5deg); }
            75% { transform: rotate(-5deg); }
        }
        .emoji-shake {
            animation: shake 1s infinite;
        }

        /* Animaci√≥n de entrada para el modal */
        @keyframes popIn {
            0% { transform: scale(0.9); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .pop-in {
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        input[type="number"] {
            -moz-appearance: textfield;
            font-size: 2rem;
        }
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
    </style>
</head>
<body id="appBody" class="bg-slate-100 h-screen w-screen overflow-hidden flex flex-col items-center justify-center text-slate-800">

    <!-- 1. PANTALLA DE CONFIGURACI√ìN -->
    <div id="setupPanel" class="w-full max-w-lg p-6 bg-white rounded-3xl shadow-2xl z-10 mx-4 transition-all transform duration-300">
        <h1 class="text-2xl md:text-3xl font-extrabold text-center text-indigo-600 mb-2">‚è±Ô∏è Tiempo de Clase</h1>
        <p class="text-center text-gray-500 mb-6 text-sm">Elige el tiempo y pulsa Iniciar</p>

        <!-- Botones r√°pidos -->
        <div class="grid grid-cols-3 gap-3 mb-6">
            <button onclick="setQuickTime(5)" class="bg-indigo-50 active:bg-indigo-200 text-indigo-700 font-bold py-3 rounded-xl border-2 border-transparent hover:border-indigo-200 transition touch-manipulation">5m</button>
            <button onclick="setQuickTime(10)" class="bg-indigo-50 active:bg-indigo-200 text-indigo-700 font-bold py-3 rounded-xl border-2 border-transparent hover:border-indigo-200 transition touch-manipulation">10m</button>
            <button onclick="setQuickTime(15)" class="bg-indigo-50 active:bg-indigo-200 text-indigo-700 font-bold py-3 rounded-xl border-2 border-transparent hover:border-indigo-200 transition touch-manipulation">15m</button>
            <button onclick="setQuickTime(30)" class="bg-indigo-50 active:bg-indigo-200 text-indigo-700 font-bold py-3 rounded-xl border-2 border-transparent hover:border-indigo-200 transition touch-manipulation">30m</button>
            <button onclick="setQuickTime(45)" class="bg-indigo-50 active:bg-indigo-200 text-indigo-700 font-bold py-3 rounded-xl border-2 border-transparent hover:border-indigo-200 transition touch-manipulation">45m</button>
            <button onclick="setQuickTime(60)" class="bg-indigo-50 active:bg-indigo-200 text-indigo-700 font-bold py-3 rounded-xl border-2 border-transparent hover:border-indigo-200 transition touch-manipulation">1h</button>
        </div>

        <!-- Entrada Manual -->
        <div class="flex justify-center items-center gap-2 mb-8 bg-gray-50 p-4 rounded-2xl">
            <div class="text-center">
                <label class="block text-xs font-bold text-gray-400 uppercase">Min</label>
                <input type="number" id="inMin" value="10" class="w-20 text-center bg-white rounded-lg border-2 border-gray-200 p-2 focus:border-indigo-500 outline-none text-slate-700" placeholder="0">
            </div>
            <span class="text-3xl font-bold text-gray-300">:</span>
            <div class="text-center">
                <label class="block text-xs font-bold text-gray-400 uppercase">Seg</label>
                <input type="number" id="inSec" value="00" class="w-20 text-center bg-white rounded-lg border-2 border-gray-200 p-2 focus:border-indigo-500 outline-none text-slate-700" placeholder="0">
            </div>
        </div>

        <button onclick="checkAndStart()" class="w-full bg-indigo-600 active:bg-indigo-800 text-white font-black text-xl py-5 rounded-2xl shadow-lg transform transition active:scale-95 touch-manipulation">
            INICIAR CUENTA ATR√ÅS
        </button>
    </div>

    <!-- 2. PANTALLA DEL TEMPORIZADOR (Oculta al inicio) -->
    <div id="timerPanel" class="force-hidden fixed inset-0 flex flex-col items-center justify-center z-20">
        
        <!-- Emoji gigante -->
        <div id="displayEmoji" class="text-[8rem] md:text-[12rem] leading-none mb-4 drop-shadow-xl transition-transform duration-300 select-none">
            üòé
        </div>

        <!-- Texto de estado -->
        <div id="displayStatus" class="text-2xl md:text-4xl font-bold text-white mb-2 uppercase tracking-widest drop-shadow-md text-center px-4">
            Tiempo de trabajo
        </div>

        <!-- Reloj Gigante -->
        <div id="displayTime" class="timer-nums text-[18vw] md:text-[15vw] font-bold text-white leading-none drop-shadow-lg select-none">
            00:00
        </div>

        <!-- Barra de progreso inferior -->
        <div class="absolute bottom-0 left-0 w-full h-4 bg-black/20">
            <div id="progressBar" class="h-full bg-white transition-all duration-1000 ease-linear" style="width: 100%"></div>
        </div>

        <!-- Botones de control flotantes -->
        <div class="absolute bottom-10 flex gap-6 z-30">
            <button onclick="togglePause()" id="btnPause" class="bg-white/90 active:bg-white text-slate-800 p-5 rounded-full shadow-xl backdrop-blur transition transform active:scale-90" aria-label="Pausar">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6" /></svg>
            </button>
            <button onclick="triggerStopConfirmation()" class="bg-red-500 active:bg-red-600 text-white p-5 rounded-full shadow-xl transition transform active:scale-90" aria-label="Cancelar">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
        </div>
    </div>

    <!-- 3. MODAL DE CONFIRMACI√ìN (Nuevo) -->
    <div id="confirmModal" class="force-hidden fixed inset-0 bg-black/80 z-50 flex items-center justify-center backdrop-blur-sm px-4">
        <div class="bg-white p-6 md:p-8 rounded-3xl w-full max-w-sm text-center shadow-2xl pop-in">
            <div class="text-6xl mb-4">ü§î</div>
            <h3 class="text-2xl font-bold text-gray-800 mb-2">¬øDetener la clase?</h3>
            <p class="text-gray-500 mb-8">La cuenta atr√°s se perder√°.</p>
            <div class="flex gap-4 justify-center">
                <button onclick="cancelStop()" class="flex-1 bg-gray-100 active:bg-gray-200 text-gray-800 font-bold py-4 rounded-xl transition text-lg">No, seguir</button>
                <button onclick="confirmStop()" class="flex-1 bg-red-500 active:bg-red-600 text-white font-bold py-4 rounded-xl transition text-lg shadow-lg shadow-red-200">S√≠, parar</button>
            </div>
        </div>
    </div>

    <!-- 4. PANTALLA FINAL (Alarma) -->
    <div id="endOverlay" style="display: none;" class="fixed inset-0 bg-red-600 z-50 flex flex-col items-center justify-center">
        <div class="text-white text-center px-4">
            <div class="text-9xl mb-4 animate-bounce">‚è∞</div>
            <h2 class="text-5xl md:text-7xl font-black mb-8 drop-shadow-md">¬°TIEMPO!</h2>
            
            <button onclick="resetApp()" class="bg-white text-red-600 font-black text-2xl py-6 px-12 rounded-full shadow-2xl hover:bg-gray-100 active:scale-95 transition-transform w-full max-w-sm mx-auto touch-manipulation cursor-pointer border-4 border-white">
                NUEVA CUENTA
            </button>
        </div>
    </div>

    <script>
        // --- Referencias ---
        let totalTime = 0;
        let timeLeft = 0;
        let timerInterval = null;
        let isPaused = false;

        const setupPanel = document.getElementById('setupPanel');
        const timerPanel = document.getElementById('timerPanel');
        const endOverlay = document.getElementById('endOverlay');
        const confirmModal = document.getElementById('confirmModal'); // Nuevo
        const appBody = document.getElementById('appBody');
        
        const inMin = document.getElementById('inMin');
        const inSec = document.getElementById('inSec');
        
        const displayTime = document.getElementById('displayTime');
        const displayEmoji = document.getElementById('displayEmoji');
        const displayStatus = document.getElementById('displayStatus');
        const progressBar = document.getElementById('progressBar');
        const btnPause = document.getElementById('btnPause');

        // --- Configuraci√≥n Visual ---
        const phases = {
            start: { color: 'bg-emerald-500', emoji: 'üòé', text: 'Trabajando...' },
            middle: { color: 'bg-yellow-400', emoji: 'üòê', text: 'Mitad de tiempo' },
            worry: { color: 'bg-orange-500', emoji: 'üòü', text: 'Atenci√≥n' },
            panic: { color: 'bg-red-500', emoji: 'üò∞', text: '¬°Acabando!' }
        };

        // --- Funciones Principales ---
        function setQuickTime(m) {
            inMin.value = m;
            inSec.value = 0;
        }

        function checkAndStart() {
            const m = parseInt(inMin.value) || 0;
            const s = parseInt(inSec.value) || 0;
            const total = (m * 60) + s;

            if (total <= 0) {
                alert("Por favor, pon al menos unos segundos.");
                return;
            }
            startTimer(total);
        }

        function startTimer(seconds) {
            totalTime = seconds;
            timeLeft = seconds;
            isPaused = false;

            setupPanel.classList.add('force-hidden');
            timerPanel.classList.remove('force-hidden');
            endOverlay.style.display = 'none';

            updateUI();
            
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                if (!isPaused) {
                    timeLeft--;
                    updateUI();
                    if (timeLeft <= 0) finishTimer();
                }
            }, 1000);
        }

        function updateUI() {
            // Tiempo
            const m = Math.floor(timeLeft / 60);
            const s = timeLeft % 60;
            displayTime.textContent = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;

            // Progreso
            const pct = (timeLeft / totalTime) * 100;
            progressBar.style.width = `${pct}%`;

            // Fases
            appBody.classList.remove('pulse-bg'); 
            displayEmoji.classList.remove('emoji-shake');

            let currentPhase = phases.start;
            if (pct <= 10 || timeLeft <= 60) {
                currentPhase = phases.panic;
                appBody.classList.add('pulse-bg');
                displayEmoji.classList.add('emoji-shake');
            } else if (pct <= 30) {
                currentPhase = phases.worry;
            } else if (pct <= 60) {
                currentPhase = phases.middle;
            }

            // Aplicar estilos
            appBody.className = `h-screen w-screen overflow-hidden flex flex-col items-center justify-center text-slate-800 transition-colors duration-1000 ${currentPhase.color}`;
            
            // Texto y Emojis
            if (currentPhase.emoji !== displayEmoji.textContent) {
                displayEmoji.textContent = currentPhase.emoji;
            }
            displayStatus.textContent = currentPhase.text;
        }

        function togglePause() {
            isPaused = !isPaused;
            if (isPaused) {
                displayStatus.textContent = "PAUSADO";
                appBody.
